{"version":3,"file":"index.js","sources":["../../src/applycation/store.ts","../../src/applycation/register.ts","../../src/global/index.ts","../../src/utils/contants.ts","../../src/utils/index.ts","../../src/events/index.ts","../../src/loader/index.ts","../../src/context/base.ts","../../src/context/vue.ts","../../src/context/phaser.ts","../../src/context/init.ts","../../src/sandbox/snapshot.ts","../../src/sandbox/patchAtMounting.ts","../../src/invoke/lifecircle.ts","../../src/invoke/index.ts","../../src/router/capturedListeners.ts","../../src/router/index.ts","../../src/index.ts"],"sourcesContent":["\nconst namespace = 'FINO'\n\nexport function setStore(key: string, value: any) {\n  if (!(window as any)[namespace]) {\n    (window as any)[namespace] = {};\n  }\n  (window as any)[namespace][key] = value;\n}\n\nexport function getStore(key: string) {\n  const fino: any = (window as any)[namespace];\n  return fino && fino[key] ? fino[key] : null;\n}\n","import { Project, BaseProject } from \"../types/project\"\nimport { invoke } from \"..\"\nimport { setStore } from \"./store\";\n\nexport let Apps: Array<Project> = []\n\nexport function registerApps(app: Array<BaseProject>): Array<Project> {\n\n  setStore('root', 'root')\n  Apps = invoke.init(app)\n\n  return Apps\n}\n","// import apps from \"../model\"\nimport Vue from 'vue'\nimport { Project } from \"../types/project\"\nimport { VueConstructor } from \"vue/types/umd\"\nimport { Apps } from '../applycation/register'\nimport { GlobalType } from '../types/context'\nimport { AppInfoType } from '../types/project/appInfo'\n// import Database from '../../../fino-database'\n\ninterface CacheType {\n  [propsName:string]: boolean;\n}\n/**\n * @class 全局单例\n */\nexport class GlobalContext {\n  // 当前正在运行的子模块\n  public activedApplication: Project\n\n  // 当前需要加载的子模块\n  public activeAppInfo: AppInfoType = {\n    app: '',\n    context: '',\n    version: ''\n  }\n\n  // 资源缓存\n  public contextSourceCache: CacheType = {};\n\n  // 当前运行环境\n  public activeContext: VueConstructor<Vue> | Window | any\n\n  constructor() {\n    this.activedApplication = Apps[0]\n\n    this.activeContext = window\n  }\n\n  // 设置运行环境\n  public setRuntimeContext<RuntimeContextType>(context: RuntimeContextType) {\n    this.activeContext = context\n  }\n}\n\n\n\nfunction getGlobalContext() {\n  const global: GlobalType = window;\n\n  if(global.globalContext) {\n    return global.globalContext;\n  }\n\n  global.globalContext = new GlobalContext()\n\n  return global.globalContext\n}\n\nexport const globalContext = getGlobalContext()\n\n\n\n","export const PEDEST_STARTED = \"PEDEST_STARTED\"\n\n\nexport const PEDEST_NOT_STARTED = \"PEDEST_NOT_STARTED\"\n\nexport const BOOTSTRAP = 'BOOTSTRAP';\n\nexport const MOUNT = 'MOUNT'\n\nexport const MOUNTED = 'MOUNTED'\n\nexport const UNMOUNT = 'UNMOUNT'\n\n","import { Project } from \"../types/project\";\n// import apps from '../model/index'\nimport { globalContext } from \"../global\";\nimport { GlobalType, MatchAppType } from \"../types/context\";\nimport { BOOTSTRAP, MOUNT, UNMOUNT } from \"./contants\";\n\n\n/**\n * @function 获取当前应该被加载的应用\n * @param { apps - 应用列表 }\n * @return { app - 需要被加载的应用 }\n */\nexport function getAppShouldBeActive(apps: Array<Project>): MatchAppType | undefined {\n  let result: MatchAppType | undefined\n  apps.forEach((item, index) => {\n    if (item.activeWhen(window.location) && item.status ) {\n      item.status === UNMOUNT && (item.status = BOOTSTRAP);\n      result = {\n        app: item,\n        index: index\n      }\n    }\n  })\n  return result\n}\n\n/**\n * @function 获取当前应该被卸载的应用\n * @param global\n * @param { apps - 应用列表 }\n * @return { app - 需要被加载的应用 }\n */\nexport function getAppShouldBeUnmount(apps: Array<Project>): Array<MatchAppType> {\n  let result: MatchAppType[] = [];\n\n  apps.forEach((item, index) => {\n    if (!item.activeWhen(window.location) && item.status === MOUNT) {\n      result.push({\n        app: item,\n        index: index\n      })\n    }\n  })\n  return result\n}\n\n// 判断是否是一个对象\nexport const isObject = (obj: unknown) => typeof(obj) === 'object' && obj !== null\n\n/**\n * @func 进入loading模式\n * @parans { show - 是否展示loading }\n */\n\n// 卸载标签\nexport function removeChild(id: string) {\n  let element = document.getElementById(id);\n  element && document.body.removeChild(element);\n}\n\n\nexport function registerEvents(global: GlobalType) {\n  if (!global.$event) { return }\n  global.$event.subscribe('baseInfoLoaded', baseInfoLoaded);\n  global.$event.subscribe('childAppLoaded', childAppLoaded);\n}\n\n\nexport function getAppMountTime(app: Project) {\n  try {\n    return app.activeWhen(window.location);\n  } catch (e) {\n    throw e;\n  }\n}\n\nexport function firstUpperCase(str: string) {\n  return str.toLowerCase().replace(/(|^)[a-z]/g, (L) => L.toUpperCase());\n}\n\nfunction baseInfoLoaded(data: any) {\n  globalContext.activeAppInfo = data\n  return data\n}\n\nfunction childAppLoaded(data: any) {\n  globalContext.activedApplication = data\n  return data\n}\n\n","interface EventsArray {\n\t[key: string]: any;\n}\n\nclass Events {\n\t// 事件池\n\tprivate _events: EventsArray = {};\n\n\t/**\n     * 添加订阅方法\n     * @param type 订阅事件的类型（名字）\n     * @param listener 订阅事件的回调\n     * @param flay 插入顺序\n     */\n    subscribe(type: string, listener: (data: any) => any | any, flag?: boolean) {\n\t\t// 如果订阅的事件在事件池里面存在\n\n\t\tif(this._events[type]) {\n\t\t\tif(this._events[type].indexOf(listener) > -1) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tflag ?\n\t\t\t\tthis._events[type].unshift(listener) :\n\t\t\t\tthis._events[type].push(listener);\n\n\t\t\treturn;\n\t\t}\n\n\n\t\tthis._events[type] = [listener];\n\t}\n\n\t/**\n     * 通知消息\n     * @param type 需要分发的事件的名字\n     * @param args 回调函数的参数\n     */\n    notify(type: string, args?: string[] | undefined | any ) {\n\n\t\tlet argument = args || [];\n\n        if(this._events[type]) {\n            this._events[type].forEach((fn: any) => fn.call(this, argument));\n        }\n    }\n\n    /**\n     * 移除当前绑定的事件\n     * @param type 事件类型\n     * @param listener 事件回调函数\n     */\n    removeListener(type: string, listener: any) {\n        if(this._events[type]) {\n            this._events[type].filter((fn: any) => {\n                return fn !== listener && fn.orign !== listener\n            })\n        }\n    }\n\n    /**\n     * 优先执行订阅\n     * @param type\n     * @param listener\n     */\n    prepend(type: string, listener: any) {\n        this.subscribe(type, listener, true)\n    }\n}\n\nexport default Events\n","import { globalContext } from \"../global\";\n\nconst baseUrl: string = \"\";\n\nexport enum AssetTypeEnum {\n  INLINE = 'inline',\n  EXTERNAL = 'external',\n}\n\nexport interface Asset {\n  type: AssetTypeEnum;\n  content: string;\n}\n\nexport function ajaxLoadJs(src: string): Promise<any> {\n  return new Promise(() => {\n    window.fetch(src).then(res => {\n\n      res.text()\n    });\n  })\n\n}\n\nexport function tagLoadJs(src: string): Promise<any> {\n  let { scriptTag, timestamp } = createJs();\n  return new Promise((resolve, reject) => {\n    scriptTag.onload = () => resolve(null);\n\n    scriptTag.onerror = (err) => {\n      setTimeout(() => {\n        document.head.removeChild(scriptTag)\n        let s2 = createJs()\n        s2.scriptTag.onload = resolve\n        s2.scriptTag.onerror = reject\n        s2.scriptTag.src = baseUrl + src + \"?\" + timestamp\n        document.head.appendChild(s2.scriptTag)\n        reject(err)\n      }, 1000)\n    }\n\n    scriptTag.src = baseUrl + src + \"?\" + timestamp\n    scriptTag.id = baseUrl + src\n    document.body.appendChild(scriptTag)\n  })\n}\n\nexport function tagLoadCss(link: string): Promise<any> {\n  let { styleTag, timestamp } = createCss();\n  return new Promise((resolve) => {\n    styleTag.onload = () => resolve(null);\n\n    styleTag.href = baseUrl + link + \"?\" + timestamp\n    styleTag.rel = \"stylesheet\"\n    styleTag.id = baseUrl + link\n    document.body.appendChild(styleTag)\n\n    resolve(null)\n  })\n}\n\nexport function getEntryJs(url: string): Promise<any> {\n  return new Promise((resolve, reject) => {\n    tagLoadJs(url).then(() => {\n      // 加载完成的内容会挂载到这个globalContext上\n      resolve(globalContext.activeAppInfo)\n    }).catch(e => {\n      reject(e)\n    })\n  })\n}\n\nfunction createCss() {\n  const styleTag: HTMLLinkElement = document.createElement('link')\n  const timestamp = + new Date();\n\n  styleTag.id = \"timestamp\"\n\n  return {\n    styleTag,\n    timestamp\n  }\n}\n\n\nfunction createJs() {\n  const scriptTag: HTMLScriptElement = document.createElement('script')\n  const timestamp = + new Date();\n\n  scriptTag.type = \"text/javascript\"\n  scriptTag.id = \"timestamp\"\n\n  return {\n    scriptTag,\n    timestamp\n  }\n}\n\nexport async function loadCss(cssList: string[]) {\n  for(let i = 0; i < cssList.length; i++) {\n    await tagLoadCss(cssList[i])\n  }\n}\n","\n/**\n * @class 管理子模块的运行环境\n * @mehtods {*} createContext\n * @mehtods {*} loadContext\n * @mehtods {*} unmountContext\n */\n\nimport { tagLoadJs } from \"../loader\";\n\nabstract class BaseModuleContext {\n  // 资源的base url\n  public baseUrl: string = `https://cdn.bootcdn.net/ajax/libs`;\n\n  public context: string = \"\"\n\n  constructor(type: string) {\n    this.context = type\n  }\n\n  // 获取运行环境沙箱\n  public getSandBoxJs(type: string, version: string) {\n    const url = `${this.baseUrl}/${type}/${version}/${type}.min.js`;\n    return tagLoadJs(url)\n  }\n\n  abstract createContext(version: string): any\n\n  abstract destroy(): void\n}\n\nexport default BaseModuleContext\n","import BaseModuleContext from \"./base\";\n\nimport { CreateElement } from \"vue/types/umd\";\nimport { globalContext } from \"../global\";\n\ninterface Global extends Window {\n  vue?: Vue,\n  VueRouter?: any,\n}\n\nclass VueRuntimeContext extends BaseModuleContext {\n  // the instance of runtime context\n  public instance?: Vue\n\n  constructor() {\n    super(\"vue\")\n  }\n\n  /**\n   * @func { Get running environment resources }\n   * @param version\n   */\n  async getContextResource(version: string) {\n    if (globalContext.contextSourceCache.vue) {\n      return\n    }\n    // 获取当前运行环境所需的资源\n    const context = await this.getSandBoxJs('vue', version)\n    const routerLib = await this.getSandBoxJs('vue-router', '3.4.3')\n\n    globalContext.contextSourceCache.vue = true\n    globalContext.contextSourceCache.vueRouter = true\n\n    return context\n  }\n\n  /**\n   * @func {*} create vue runtime context\n   */\n  createContext(version: string) {\n    // create root node\n    let rootDom = document.createElement('div');\n    rootDom.setAttribute('id', 'fino-vue-root');\n    document.body.appendChild(rootDom);\n    (window as any)['Vue2'] = (window as any)['Vue'] || (window as any)['Vue2'];\n    (window as any)['Vue'] = undefined;\n    const Vue = (window as any)['Vue2'];\n    const VueRouter = (window as any).VueRouter\n\n    Vue.use(VueRouter)\n    const router = new VueRouter({\n      mode: 'history',\n      routes: []\n    })\n\n    const vue = (window as any).vm = new (Vue as any)({\n      el: rootDom,\n      router,\n      render: (h: CreateElement) => h('div', { attrs: { id: 'fino-vue-root' } },\n        [\n          h('RouterView')\n        ]\n      )\n    })\n\n    return vue\n  }\n\n  /**\n   * @func { Injection router }\n   */\n  injectionRouter(routes: Array<any>) {\n    if (!this.instance) {\n      return\n    }\n\n    (this as any).instance.$router.addRoutes(routes);\n\n    (this as any).instance.$router.options.routes = routes\n  }\n\n  /**\n   * @func { Uninstall the runtime environment }\n   */\n  destroy() {\n    this.instance && this.instance.$destroy()\n    const element = document.getElementById('fino-vue-root')\n    element && document.body.removeChild(element)\n  }\n}\n\nexport default VueRuntimeContext\n","import BaseModuleContext from \"./base\";\nimport { tagLoadJs } from \"../loader\";\nimport { globalContext } from \"../global\";\n\n/// <reference path=\"../types/phaser.d.ts\" />\n\nclass PhaserRuntimeContext extends BaseModuleContext {\n  // 当前runtime\n  public instance?: any | null\n\n  // 实例\n  public element?: HTMLElement | null\n\n  constructor() {\n    super(\"phaser\")\n  }\n\n  /**\n   * @func 获取资源\n   * @param version\n   */\n  async getContextResource(version: string) {\n    if (globalContext.contextSourceCache.phaser) {\n      return\n    }\n    // 获取当前运行环境所需的资源\n    const context = await this.getSandBoxJs('phaser', version)\n    //\n    const Phaser = (window as any)['Phaser'];\n    globalContext.contextSourceCache.phaser = true\n    globalContext.contextSourceCache.SpinePlugin = true\n\n    return Phaser\n  }\n\n  /**\n   * @func {*} Initialize the phaser operating environment\n   */\n  createContext() {\n    // phaser3.23不可以异步注入场景， 因此需要在注入路由的时候创建实例\n\n  }\n\n  initGame(scenes: Array<any>) {\n    const root = document.createElement('div')\n    root.id = 'root'\n    document.body.appendChild(root)\n    // Create game instance\n    const gameConfig: Phaser.Types.Core.GameConfig = {\n      type: Phaser.AUTO,\n      width: window.innerWidth,\n      height: window.innerHeight,\n      resolution: 2,\n      autoFocus: true,\n      transparent: true,\n      parent: root,\n      scene: scenes,\n      scale: {\n        mode: Phaser.Scale.FIT,\n        autoCenter: Phaser.Scale.CENTER_BOTH\n      },\n    }\n\n    // debugger\n    const game = new Phaser.Game(gameConfig)\n\n    return (game as any)\n  }\n\n  /**\n   * @func {*} injection routing\n   */\n  injectionRouter(scenes: Array<any>,) {\n    if (!this.instance) {\n      this.instance = this.initGame([scenes[scenes.length - 1]])\n      scenes.pop()\n    }\n\n    let canvas = document.querySelector('#root')\n    canvas && canvas.setAttribute('style', `display: block`)\n\n    Object.keys(scenes).map((key, index) => {\n      this.instance && this.instance.scene.add((scenes as any)[(key)].name, scenes[index])\n    })\n  }\n\n\n  /**\n   * @func {*} destroy the current running instance\n   * @remark {}\n   */\n  destroy() {\n    if (!this.instance) {\n      return\n    }\n\n    let canvas = document.querySelector('#root')\n    canvas && document.body.removeChild(canvas)\n    this.instance.destroy(true);\n    this.instance.plugins.removeScenePlugin('SpinePlugin')\n  }\n}\n\nexport default PhaserRuntimeContext\n","import VueRuntimeContext from \"./vue\";\nimport { ContextType } from \"../types/context\";\nimport PhaserRuntimeContext from \"./phaser\";\n\n/**\n * @function { Initialize the runtime context }\n * @param { context - runtime context type: like vue }\n * @param { version - runtime context version: string }\n *\n */\n\nasync function initRuntimeContext(context: string, version: string): Promise<ContextType['context']> {\n  const runtimePool: any = {\n    vue: VueRuntimeContext,\n    phaser: PhaserRuntimeContext\n  }\n\n  const runtime: ContextType['context'] = new runtimePool[context]();\n\n  await runtime.getContextResource(version);\n\n  runtime.instance = runtime.createContext(version)\n\n\n  return runtime\n}\n\nexport default initRuntimeContext\n","function iter(obj: object, callbackFn: (prop: any) => void) {\n  // eslint-disable-next-line guard-for-in, no-restricted-syntax\n  for (const prop in obj) {\n    if (obj.hasOwnProperty(prop)) {\n      callbackFn(prop);\n    }\n  }\n}\n\ninterface ObjectProps {\n  [props: string]: Record<any, any>\n}\n\n\nexport default class SnapshotSandbox {\n  proxy: WindowProxy;\n\n  name: string;\n\n  type: string = 'Snapshot';\n\n  sandboxRunning = true;\n\n  private windowSnapshot!: Window | any;\n\n  private modifyPropsMap: ObjectProps = {};\n\n  // 缓存应用名字\n  public appCache: Array<string> = []\n\n  constructor(name: string) {\n    this.name = name;\n    this.proxy = window;\n  }\n\n  active() {\n    const _window: any = window\n\n    // 记录当前快照\n    this.windowSnapshot = {} as Window;\n    this.modifyPropsMap[this.name] = this.modifyPropsMap[this.name] || {};\n\n    !this.appCache.includes(this.name) && this.appCache.push(this.name)\n\n    iter(_window, prop => {\n      this.windowSnapshot[prop] = _window[prop];\n    });\n\n    // 恢复之前的变更\n    Object.keys(this.modifyPropsMap[this.name]).forEach((p: any) => {\n      _window[p] = this.modifyPropsMap[this.name][p];\n    });\n\n    this.sandboxRunning = true;\n  }\n\n  inactive() {\n    const _window: any = window\n    if(!this.windowSnapshot || !this.name) {\n      return\n    }\n\n    this.modifyPropsMap[this.name] = {};\n\n    iter(window, prop => {\n      if (_window[prop] !== this.windowSnapshot[prop]) {\n        // 记录变更，恢复环境\n        this.modifyPropsMap[this.name][prop] = _window[prop];\n        _window[prop] = this.windowSnapshot[prop];\n      }\n    });\n\n    if (process.env.NODE_ENV === 'development') {\n      console.info(`[andbox] ${this.name} origin window restore...`, Object.keys(this.modifyPropsMap[this.name]));\n    }\n\n    this.sandboxRunning = false;\n  }\n}\n","const rawWindowInterval = window.setInterval;\nconst rawWindowClearInterval = window.clearInterval;\n\n(window as any).intervals = [];\n\nexport function patchInterval(global: Window) {\n  const _window: any = window\n\n  global.clearInterval = (intervalId: number) => {\n    _window.intervals = _window.intervals.filter((id: number) => id !== intervalId);\n    return rawWindowClearInterval(intervalId);\n  };\n\n  global.setInterval = (handler: Function, timeout?: number, ...args: any[]) => {\n    const intervalId = rawWindowInterval(handler, timeout, ...args);\n\n    console.log('intervalId', intervalId);\n\n    if(!_window.intervals.includes(intervalId)) {\n      _window.intervals = [..._window.intervals, intervalId];\n    }\n\n    return intervalId;\n  };\n\n  return function free() {\n    _window.intervals.forEach((id: number) => {\n      global.clearInterval(id)\n    });\n  };\n}\n","import VueRuntimeContext from \"../context/vue\";\nimport { globalContext } from \"../global\";\nimport { getEntryJs, loadCss } from \"../loader\";\nimport Sandbox from \"../sandbox\";\nimport SnapshotSandbox from \"../sandbox/snapshot\";\nimport { MatchAppType } from \"../types/context\";\nimport { Project } from \"../types/project\";\nimport { removeChild } from \"../utils\";\nimport { MOUNT, UNMOUNT } from \"../utils/contants\";\n\n/**\n * @methods { life cycle-bootstrap }\n */\nexport async function bootstrap(app: Project, sandbox: SnapshotSandbox, loadFn: (baseDomain: string, assetsData: any) => Promise<Project>) {\n  let activeProject: Project['appInfo'];\n\n  const entryStatePath = app.entry.indexOf('http') > -1 ? app.entry : app.domain + app.entry;\n\n   // Get application js packaging information\n   activeProject = await getEntryJs(entryStatePath);\n\n   // activate the sandbox\n   if(!sandbox.appCache.includes(app.name)) {\n    sandbox.name = app.name\n    sandbox.active()\n  }\n\n  // load application entry file { init: () => {}, name: string, destory: () => {} }\n  globalContext.activedApplication = await loadFn(app.domain, globalContext.activeAppInfo);\n\n  removeChild(app.domain + app.entry);\n\n  // Execute mount life cycle\n  return mount(app, sandbox)\n}\n\n/**\n * @methods { life cycle-mount }\n * @des Create a running environment and inject routing\n */\nexport async function mount(app: Project, sandbox: SnapshotSandbox,) {\n  const runtime = globalContext.activeContext\n\n  // The runtime context is initialized successfully, and the route is injected\n  if(app.status === MOUNT) {\n    globalContext.activedApplication = app\n    sandbox.name = app.name\n    sandbox.active()\n  }\n\n  app.dynamicElements.css && (await loadCss(app.dynamicElements.css))\n\n  if(app.name === globalContext.activedApplication.name)  {\n    // injection router\n    globalContext.activedApplication.init && globalContext.activedApplication.init((runtime as VueRuntimeContext), globalContext.activeContext)\n  }\n\n  app.status = MOUNT\n\n  return app\n}\n\n/**\n * @methods { life cycle-unmount }\n * @des\n*/\nexport async function unmount(apps: MatchAppType[], sandbox: SnapshotSandbox, mode: string) {\n  return new Promise<void>((resolve) => {\n    if(!apps) { resolve() }\n    // resolve()\n\n    for(let i = 0; i < apps.length; i++) {\n      if(!apps[i].app.dynamicElements.js) continue\n      // 卸载应用标签\n      for(let j = 0; j < apps[i].app.dynamicElements.js.length; j++) {\n        removeChild(apps[i].app.dynamicElements.js[j])\n      }\n\n      for(let j = 0; j < apps[i].app.dynamicElements.css.length; j++) {\n        removeChild(apps[i].app.dynamicElements.css[j])\n      }\n\n      if(mode === 'safe') {\n        apps[i].app.dynamicElements.js = []\n        // 将状态设置位UNMOUNT\n        apps[i].app.status = UNMOUNT;\n      }\n\n    }\n\n    sandbox.inactive()\n\n    resolve()\n  })\n}\n\n/**\n * @methods The application is successfully mounted, and the sub-application is notified\n */\nexport async function  mounted() {\n\n}\n","import { Project, BaseProject } from \"../types/project\";\nimport { Apps } from \"../applycation/register\";\nimport { getStore, setStore } from \"../applycation/store\";\nimport { getAppShouldBeActive, getAppShouldBeUnmount, registerEvents, removeChild } from \"../utils\";\nimport { GlobalType, ContextType, MatchAppType } from '../types/context'\nimport Events from \"../events\";\nimport { getEntryJs } from \"../loader\";\nimport { globalContext } from \"../global\";\nimport initRuntimeContext from \"../context/init\";\nimport { BOOTSTRAP, MOUNT } from \"../utils/contants\";\nimport SnapshotSandbox from \"../sandbox/snapshot\";\nimport { patchInterval } from \"../sandbox/patchAtMounting\";\nimport { bootstrap, mount, unmount } from './lifecircle'\n\nenum LifeCircle {\n  BOOTSTRAP = 'bootstrap',\n  MOUNTED = 'mount'\n}\n\nconst global: GlobalType = window\n\nconst lifecircleFn = { bootstrap, mount }\n\nlet isFrist = true\n\nclass Invoke {\n  // Operating environment: whether to run on the base or the sub-module to run independently\n  public runtimeInfino: boolean = true;\n  // Application List\n  public appList: Array<Project> = [];\n  // Run submodule: the first one by default\n  public app: Project = Apps[0];\n  // Event\n  public $event: Events;\n  // mode: safe or speed\n  public mode: string = 'speed'\n\n  // sandbox\n  public sandbox: SnapshotSandbox\n\n  // interval\n  public free: any\n\n  constructor() {\n    const global: GlobalType = window\n\n    this.$event = global.$event = new Events();\n    this.sandbox = new SnapshotSandbox('')\n\n    registerEvents(global)\n\n    this.free = patchInterval(window)\n  }\n\n  /**\n   * @methods { Initialize the project list }\n   * @param apps { project list as array }\n   */\n  public init(apps: Array<BaseProject>) {\n    apps.map((item, index) => {\n      item.status = BOOTSTRAP\n    })\n\n    this.appList = (apps as Project[])\n\n    return this.appList\n  }\n\n  /**\n   * @methods { Scheduling applications, uninstalling the runtime, and mounting new applications }\n   * @desc\n   * @params { - apps: Project child project list }\n   */\n  async performAppChnage(apps: Array<Project>) {\n    // Get the application that needs to be mounted\n    const activeApp = getAppShouldBeActive(apps);\n\n    if(!activeApp) {\n      throw new Error('没有需要挂载的应用');\n      return\n    }\n\n    this.app = activeApp.app\n\n    this.app.dynamicElements = this.app.dynamicElements || { js: [], css: [] }\n\n    // uninstall apps that do not require activation\n    const unmountApps = getAppShouldBeUnmount(apps);\n\n    // restore the sandbox environment\n    if(!isFrist) {\n      this.free()\n    }\n\n    isFrist = false\n    if(unmountApps) {\n      await unmount(unmountApps, this.sandbox, this.mode)\n    }\n\n    this.$event.notify('beforeAppEnter')\n\n\n    if(this.app.status === MOUNT) {\n      globalContext.activedApplication = this.app\n    }\n\n    // Trigger loading animation\n    if(!this.app.init) {\n      this.$event.notify('appLeave')\n    }\n\n    globalContext.activeContext = await this.setRuntimeContext(this.app);\n\n    // Get the life cycle function of the current application(bootstrap, mount)\n    const lifecircle = this.app.status.toLocaleLowerCase();\n\n    this.app = await lifecircleFn[(lifecircle as LifeCircle)](this.app, this.sandbox, this.getModuleJs.bind(this))\n\n    // At this time, the various information of the app is ready, merge the cached information to the current app\n    this.app = Object.assign(this.app, globalContext.activeAppInfo,  globalContext.activedApplication)\n\n    Apps[activeApp.index] = this.app\n\n    this.$event.notify('appEnter')\n  }\n\n\n  /**\n   * @methods The application is successfully mounted, and the sub-application is notified\n   */\n  public async setRuntimeContext(activeProject: Project['appInfo']): Promise<ContextType['context']> {\n    if(!activeProject) {\n      return globalContext.activeContext\n    }\n\n    // Create the runtime context\n    let runtime: ContextType['context'] = globalContext.activeContext;\n\n    // If the runtime context of the new application is different from the previous one, uninstall it\n    if(!this.app.context || this.app.context !== globalContext.activeContext.context) {\n\n      activeProject.context &&\n      Object.assign(globalContext.activeAppInfo, {\n        context: activeProject.context, version: activeProject.version\n      })\n\n      // uninstall before app runtime context,\n      if(runtime && runtime.destroy) {\n        runtime.destroy()\n\n      }\n\n      // store the created runtime environment in the global\n      runtime = globalContext.activeContext = await initRuntimeContext(globalContext.activeAppInfo.context, globalContext.activeAppInfo.version);\n    }else {\n\n      // If the runtime context is the same, reuse directly\n      runtime = globalContext.activeContext\n    }\n\n    return runtime\n  }\n\n  /**\n   * @methods Get application js\n   */\n  async getModuleJs(baseDomain: string, assetsData: any): Promise<Project> {\n    // const assets = Object.keys(assetsData);\n    for(let i = 0; i < assetsData.length; i++) {\n\n      if(typeof(assetsData[i]) === 'string') {\n        const entry = assetsData[i]\n        const url = baseDomain + '/' + entry\n\n\n        if(entry.indexOf('.css') > -1) {\n\n          this.app.dynamicElements.css.indexOf(url) === -1  &&\n            this.app.dynamicElements.css.push(url)\n          continue\n        }else if(entry.indexOf('.js') > -1){\n          await getEntryJs(url)\n        }else {\n          let source = new Image()\n          source.src = url\n        }\n\n        if(this.mode === 'safe') {\n          this.app.dynamicElements.js.push(url)\n        }\n\n        continue\n      }\n    }\n\n    return globalContext.activedApplication\n  }\n\n  /**\n   * @methods { runtimeInFino }\n   * @desc { 确定当前是否在基座运行 }\n   */\n  public isInFinoRuntime() {\n    return !!getStore('root');\n  }\n\n  public start() {\n    setStore('root', 'root')\n    this.performAppChnage(this.appList)\n  }\n}\n\nexport default Invoke\n","\nexport const routingEventsListeningTo = [\n  'popstate', 'hashChange'\n]\n\nconst captureEventListeners: any = {\n  'popstate': [],\n  'hashChange': [],\n}\n\nlet historyState: any\n\nexport function callCaptureedEventListeners() {\n  if(historyState) {\n    Object.keys(captureEventListeners).forEach(eventName => {\n      const capturedListeners = (captureEventListeners as any)[eventName];\n      if(capturedListeners.length) {\n        capturedListeners.forEach((listener: any) => {\n          listener.call(null, createPopStateEvent(historyState));\n        })\n      }\n\n    })\n  }\n}\n\nexport function createPopStateEvent(state: any) {\n  // We need a popstate event even though the browser doesn't do one by default when you call replaceState, so that\n  // all the applications can reroute.\n  try {\n    return new PopStateEvent('popstate', { state });\n  } catch (err) {\n    // IE 11 compatibility\n    // https://docs.microsoft.com/en-us/openspecs/ie_standards/ms-html5e/bd560f47-b349-4d2c-baa8-f1560fb489dd\n    const evt: any = document.createEvent('PopStateEvent');\n    evt.initPopStateEvent('popstate', false, false, state);\n    return evt;\n  }\n}\n\nexport function isInCapturedEventListeners(eventName: string, fn: any) {\n  return find(captureEventListeners[eventName], fn);\n}\n\nexport function addCapturedEventListeners(eventName: string, fn: any) {\n  captureEventListeners[eventName].push(fn);\n}\n\nexport function removeCapturedEventListeners(eventName: string, listenerFn: any) {\n  captureEventListeners[eventName] = captureEventListeners[eventName].filter(\n    (fn: any) => fn !== listenerFn,\n  );\n}\n\nexport function find(list: Array<any>, element: any) {\n  if (!Array.isArray(list)) {\n    return false;\n  }\n\n  return list.filter(item => item === element).length > 0;\n}\n\n","import { routingEventsListeningTo, isInCapturedEventListeners, addCapturedEventListeners, removeCapturedEventListeners } from \"./capturedListeners\";\nimport Invoke from \"../invoke\";\nimport { Apps } from \"../applycation/register\";\nimport { globalContext } from \"../global\";\n\n// 缓存原生事件， 后面需要重写\nconst originalAddEventListener = window.addEventListener;\nconst originalRemoveEventLister = window.removeEventListener;\nconst originalPushState = window.history.pushState;\nconst originalReplaceState = window.history.replaceState;\n\nclass Router {\n  public invoke: Invoke\n  constructor(invoke: Invoke) {\n    this.invoke = invoke\n\n    this.hijackHistory();\n    this.hijackEventListener();\n  }\n\n  reroute() {\n    this.invoke.app && this.invoke.performAppChnage(Apps)\n  }\n\n  push(url: string) {\n    // if(globalContext.activeContext.instance) {\n\n    // }\n    // globalContext.activeContext.instance.$router.push(url)\n    window.history.pushState(null, '', url)\n  }\n\n  hijackHistory() {\n    const me = this\n    window.history.pushState = function (state: any, title: string, url: string | null | undefined, ...rest) {\n      let result = originalPushState.apply(this, [state, title, url]);\n      me.reroute()\n      return result\n    }\n\n    window.history.replaceState = function (state: any, title: string, url: string | null | undefined, ...rest) {\n      let result = originalReplaceState.apply(this, [state, title, url])\n      me.reroute();\n      return result;\n    }\n\n    window.onpopstate = (event: PopStateEvent) => {\n\n      me.reroute();\n    }\n\n    window.addEventListener('popstate', () => {\n      me.reroute();\n    }, false);\n  }\n  // EventListenerOrEventListenerObject\n  hijackEventListener() {\n    window.addEventListener = (eventName: string, fn: EventListenerOrEventListenerObject, purpol?: boolean | AddEventListenerOptions) => {\n      if (\n        typeof fn === 'function' &&\n        routingEventsListeningTo.indexOf(eventName) > -1 &&\n        !isInCapturedEventListeners(eventName, fn)\n      ) {\n        addCapturedEventListeners(eventName, fn);\n        return;\n      }\n\n      return originalAddEventListener.apply(window, [eventName, fn, purpol]);\n\n    }\n\n    window.removeEventListener = (eventName: string, fn: EventListenerOrEventListenerObject, purpol?: boolean | AddEventListenerOptions) => {\n      if (typeof fn === 'function' && routingEventsListeningTo.indexOf(eventName) >= 0) {\n        removeCapturedEventListeners(eventName, fn);\n        return;\n      }\n\n      return originalRemoveEventLister.apply(window, [eventName, fn, purpol]);\n    };\n  }\n\n  handlePopState(event: PopStateEvent): void {\n\n  }\n}\n\nexport default Router\n","\nimport { registerApps } from './applycation/register';\nimport Invoke from './invoke/index';\nimport Router from './router';\nimport {  GlobalType } from './types/context';\nconst global: GlobalType = window\nconst invoke = new Invoke()\nconst router = new Router(invoke)\n\n\n\nconsole.log('33')\n\nexport { registerApps, invoke, router }\n\n"],"names":[],"mappings":";;;;;;EACA,MAAM,SAAS,GAAG,MAAM,CAAA;WAER,QAAQ,CAAC,GAAW,EAAE,KAAU;MAC9C,IAAI,CAAE,MAAc,CAAC,SAAS,CAAC,EAAE;UAC9B,MAAc,CAAC,SAAS,CAAC,GAAG,EAAE,CAAC;OACjC;MACA,MAAc,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC;EAC1C,CAAC;WAEe,QAAQ,CAAC,GAAW;MAClC,MAAM,IAAI,GAAS,MAAc,CAAC,SAAS,CAAC,CAAC;MAC7C,OAAO,IAAI,IAAI,IAAI,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC;EAC9C;;ECTO,IAAI,IAAI,GAAmB,EAAE,CAAA;WAEpB,YAAY,CAAC,GAAuB;MAElD,QAAQ,CAAC,MAAM,EAAE,MAAM,CAAC,CAAA;MACxB,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;MAEvB,OAAO,IAAI,CAAA;EACb;;ECAA;;;QAGa,aAAa;MAiBxB;;UAZO,kBAAa,GAAgB;cAClC,GAAG,EAAE,EAAE;cACP,OAAO,EAAE,EAAE;cACX,OAAO,EAAE,EAAE;WACZ,CAAA;;UAGM,uBAAkB,GAAc,EAAE,CAAC;UAMxC,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC,CAAC,CAAC,CAAA;UAEjC,IAAI,CAAC,aAAa,GAAG,MAAM,CAAA;OAC5B;;MAGM,iBAAiB,CAAqB,OAA2B;UACtE,IAAI,CAAC,aAAa,GAAG,OAAO,CAAA;OAC7B;GACF;EAID,SAAS,gBAAgB;MACvB,MAAM,MAAM,GAAe,MAAM,CAAC;MAElC,IAAG,MAAM,CAAC,aAAa,EAAE;UACvB,OAAO,MAAM,CAAC,aAAa,CAAC;OAC7B;MAED,MAAM,CAAC,aAAa,GAAG,IAAI,aAAa,EAAE,CAAA;MAE1C,OAAO,MAAM,CAAC,aAAa,CAAA;EAC7B,CAAC;EAEM,MAAM,aAAa,GAAG,gBAAgB,EAAE;;ECrDxC,MAAM,SAAS,GAAG,WAAW,CAAC;EAE9B,MAAM,KAAK,GAAG,OAAO,CAAA;EAIrB,MAAM,OAAO,GAAG,SAAS;;ECVhC;EAMA;;;;;WAKgB,oBAAoB,CAAC,IAAoB;MACvD,IAAI,MAAgC,CAAA;MACpC,IAAI,CAAC,OAAO,CAAC,CAAC,IAAI,EAAE,KAAK;UACvB,IAAI,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,IAAI,CAAC,MAAM,EAAG;cACpD,IAAI,CAAC,MAAM,KAAK,OAAO,KAAK,IAAI,CAAC,MAAM,GAAG,SAAS,CAAC,CAAC;cACrD,MAAM,GAAG;kBACP,GAAG,EAAE,IAAI;kBACT,KAAK,EAAE,KAAK;eACb,CAAA;WACF;OACF,CAAC,CAAA;MACF,OAAO,MAAM,CAAA;EACf,CAAC;EAED;;;;;;WAMgB,qBAAqB,CAAC,IAAoB;MACxD,IAAI,MAAM,GAAmB,EAAE,CAAC;MAEhC,IAAI,CAAC,OAAO,CAAC,CAAC,IAAI,EAAE,KAAK;UACvB,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,IAAI,CAAC,MAAM,KAAK,KAAK,EAAE;cAC9D,MAAM,CAAC,IAAI,CAAC;kBACV,GAAG,EAAE,IAAI;kBACT,KAAK,EAAE,KAAK;eACb,CAAC,CAAA;WACH;OACF,CAAC,CAAA;MACF,OAAO,MAAM,CAAA;EACf,CAAC;EAKD;;;;EAKA;WACgB,WAAW,CAAC,EAAU;MACpC,IAAI,OAAO,GAAG,QAAQ,CAAC,cAAc,CAAC,EAAE,CAAC,CAAC;MAC1C,OAAO,IAAI,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;EAChD,CAAC;WAGe,cAAc,CAAC,MAAkB;MAC/C,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE;UAAE,OAAM;OAAE;MAC9B,MAAM,CAAC,MAAM,CAAC,SAAS,CAAC,gBAAgB,EAAE,cAAc,CAAC,CAAC;MAC1D,MAAM,CAAC,MAAM,CAAC,SAAS,CAAC,gBAAgB,EAAE,cAAc,CAAC,CAAC;EAC5D,CAAC;EAeD,SAAS,cAAc,CAAC,IAAS;MAC/B,aAAa,CAAC,aAAa,GAAG,IAAI,CAAA;MAClC,OAAO,IAAI,CAAA;EACb,CAAC;EAED,SAAS,cAAc,CAAC,IAAS;MAC/B,aAAa,CAAC,kBAAkB,GAAG,IAAI,CAAA;MACvC,OAAO,IAAI,CAAA;EACb;;ECpFA,MAAM,MAAM;MAAZ;;UAES,YAAO,GAAgB,EAAE,CAAC;OA8DlC;;;;;;;MAtDG,SAAS,CAAC,IAAY,EAAE,QAAkC,EAAE,IAAc;;UAG5E,IAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;cACtB,IAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,EAAE;kBAC7C,OAAM;eACN;cAED,IAAI;kBACH,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC;kBACpC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;cAEnC,OAAO;WACP;UAGD,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;OAChC;;;;;;MAOE,MAAM,CAAC,IAAY,EAAE,IAAiC;UAExD,IAAI,QAAQ,GAAG,IAAI,IAAI,EAAE,CAAC;UAEpB,IAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;cACnB,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,CAAC,EAAO,KAAK,EAAE,CAAC,IAAI,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC,CAAC;WACpE;OACJ;;;;;;MAOD,cAAc,CAAC,IAAY,EAAE,QAAa;UACtC,IAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;cACnB,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,CAAC,EAAO;kBAC9B,OAAO,EAAE,KAAK,QAAQ,IAAI,EAAE,CAAC,KAAK,KAAK,QAAQ,CAAA;eAClD,CAAC,CAAA;WACL;OACJ;;;;;;MAOD,OAAO,CAAC,IAAY,EAAE,QAAa;UAC/B,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,QAAQ,EAAE,IAAI,CAAC,CAAA;OACvC;;;ECjEL,MAAM,OAAO,GAAW,EAAE,CAAC;EAE3B,IAAY,aAGX;EAHD,WAAY,aAAa;MACvB,kCAAiB,CAAA;MACjB,sCAAqB,CAAA;EACvB,CAAC,EAHW,aAAa,KAAb,aAAa,QAGxB;WAiBe,SAAS,CAAC,GAAW;MACnC,IAAI,EAAE,SAAS,EAAE,SAAS,EAAE,GAAG,QAAQ,EAAE,CAAC;MAC1C,OAAO,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM;UACjC,SAAS,CAAC,MAAM,GAAG,MAAM,OAAO,CAAC,IAAI,CAAC,CAAC;UAEvC,SAAS,CAAC,OAAO,GAAG,CAAC,GAAG;cACtB,UAAU,CAAC;kBACT,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC,CAAA;kBACpC,IAAI,EAAE,GAAG,QAAQ,EAAE,CAAA;kBACnB,EAAE,CAAC,SAAS,CAAC,MAAM,GAAG,OAAO,CAAA;kBAC7B,EAAE,CAAC,SAAS,CAAC,OAAO,GAAG,MAAM,CAAA;kBAC7B,EAAE,CAAC,SAAS,CAAC,GAAG,GAAG,OAAO,GAAG,GAAG,GAAG,GAAG,GAAG,SAAS,CAAA;kBAClD,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC,SAAS,CAAC,CAAA;kBACvC,MAAM,CAAC,GAAG,CAAC,CAAA;eACZ,EAAE,IAAI,CAAC,CAAA;WACT,CAAA;UAED,SAAS,CAAC,GAAG,GAAG,OAAO,GAAG,GAAG,GAAG,GAAG,GAAG,SAAS,CAAA;UAC/C,SAAS,CAAC,EAAE,GAAG,OAAO,GAAG,GAAG,CAAA;UAC5B,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC,CAAA;OACrC,CAAC,CAAA;EACJ,CAAC;WAEe,UAAU,CAAC,IAAY;MACrC,IAAI,EAAE,QAAQ,EAAE,SAAS,EAAE,GAAG,SAAS,EAAE,CAAC;MAC1C,OAAO,IAAI,OAAO,CAAC,CAAC,OAAO;UACzB,QAAQ,CAAC,MAAM,GAAG,MAAM,OAAO,CAAC,IAAI,CAAC,CAAC;UAEtC,QAAQ,CAAC,IAAI,GAAG,OAAO,GAAG,IAAI,GAAG,GAAG,GAAG,SAAS,CAAA;UAChD,QAAQ,CAAC,GAAG,GAAG,YAAY,CAAA;UAC3B,QAAQ,CAAC,EAAE,GAAG,OAAO,GAAG,IAAI,CAAA;UAC5B,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAA;UAEnC,OAAO,CAAC,IAAI,CAAC,CAAA;OACd,CAAC,CAAA;EACJ,CAAC;WAEe,UAAU,CAAC,GAAW;MACpC,OAAO,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM;UACjC,SAAS,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;;cAElB,OAAO,CAAC,aAAa,CAAC,aAAa,CAAC,CAAA;WACrC,CAAC,CAAC,KAAK,CAAC,CAAC;cACR,MAAM,CAAC,CAAC,CAAC,CAAA;WACV,CAAC,CAAA;OACH,CAAC,CAAA;EACJ,CAAC;EAED,SAAS,SAAS;MAChB,MAAM,QAAQ,GAAoB,QAAQ,CAAC,aAAa,CAAC,MAAM,CAAC,CAAA;MAChE,MAAM,SAAS,GAAG,CAAE,IAAI,IAAI,EAAE,CAAC;MAE/B,QAAQ,CAAC,EAAE,GAAG,WAAW,CAAA;MAEzB,OAAO;UACL,QAAQ;UACR,SAAS;OACV,CAAA;EACH,CAAC;EAGD,SAAS,QAAQ;MACf,MAAM,SAAS,GAAsB,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAA;MACrE,MAAM,SAAS,GAAG,CAAE,IAAI,IAAI,EAAE,CAAC;MAE/B,SAAS,CAAC,IAAI,GAAG,iBAAiB,CAAA;MAClC,SAAS,CAAC,EAAE,GAAG,WAAW,CAAA;MAE1B,OAAO;UACL,SAAS;UACT,SAAS;OACV,CAAA;EACH,CAAC;EAEM,eAAe,OAAO,CAAC,OAAiB;MAC7C,KAAI,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;UACtC,MAAM,UAAU,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAA;OAC7B;EACH;;ECrGA;;;;;;EASA,MAAe,iBAAiB;MAM9B,YAAY,IAAY;;UAJjB,YAAO,GAAW,mCAAmC,CAAC;UAEtD,YAAO,GAAW,EAAE,CAAA;UAGzB,IAAI,CAAC,OAAO,GAAG,IAAI,CAAA;OACpB;;MAGM,YAAY,CAAC,IAAY,EAAE,OAAe;UAC/C,MAAM,GAAG,GAAG,GAAG,IAAI,CAAC,OAAO,IAAI,IAAI,IAAI,OAAO,IAAI,IAAI,SAAS,CAAC;UAChE,OAAO,SAAS,CAAC,GAAG,CAAC,CAAA;OACtB;;;ECdH,MAAM,iBAAkB,SAAQ,iBAAiB;MAI/C;UACE,KAAK,CAAC,KAAK,CAAC,CAAA;OACb;;;;;MAMD,MAAM,kBAAkB,CAAC,OAAe;UACtC,IAAI,aAAa,CAAC,kBAAkB,CAAC,GAAG,EAAE;cACxC,OAAM;WACP;;UAED,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,YAAY,CAAC,KAAK,EAAE,OAAO,CAAC,CAAA;UACvD,MAAM,SAAS,GAAG,MAAM,IAAI,CAAC,YAAY,CAAC,YAAY,EAAE,OAAO,CAAC,CAAA;UAEhE,aAAa,CAAC,kBAAkB,CAAC,GAAG,GAAG,IAAI,CAAA;UAC3C,aAAa,CAAC,kBAAkB,CAAC,SAAS,GAAG,IAAI,CAAA;UAEjD,OAAO,OAAO,CAAA;OACf;;;;MAKD,aAAa,CAAC,OAAe;;UAE3B,IAAI,OAAO,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;UAC5C,OAAO,CAAC,YAAY,CAAC,IAAI,EAAE,eAAe,CAAC,CAAC;UAC5C,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;UAClC,MAAc,CAAC,MAAM,CAAC,GAAI,MAAc,CAAC,KAAK,CAAC,IAAK,MAAc,CAAC,MAAM,CAAC,CAAC;UAC3E,MAAc,CAAC,KAAK,CAAC,GAAG,SAAS,CAAC;UACnC,MAAM,GAAG,GAAI,MAAc,CAAC,MAAM,CAAC,CAAC;UACpC,MAAM,SAAS,GAAI,MAAc,CAAC,SAAS,CAAA;UAE3C,GAAG,CAAC,GAAG,CAAC,SAAS,CAAC,CAAA;UAClB,MAAM,MAAM,GAAG,IAAI,SAAS,CAAC;cAC3B,IAAI,EAAE,SAAS;cACf,MAAM,EAAE,EAAE;WACX,CAAC,CAAA;UAEF,MAAM,GAAG,GAAI,MAAc,CAAC,EAAE,GAAG,IAAK,GAAW,CAAC;cAChD,EAAE,EAAE,OAAO;cACX,MAAM;cACN,MAAM,EAAE,CAAC,CAAgB,KAAK,CAAC,CAAC,KAAK,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE,EAAE,eAAe,EAAE,EAAE,EACvE;kBACE,CAAC,CAAC,YAAY,CAAC;eAChB,CACF;WACF,CAAC,CAAA;UAEF,OAAO,GAAG,CAAA;OACX;;;;MAKD,eAAe,CAAC,MAAkB;UAChC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;cAClB,OAAM;WACP;UAEA,IAAY,CAAC,QAAQ,CAAC,OAAO,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;UAEhD,IAAY,CAAC,QAAQ,CAAC,OAAO,CAAC,OAAO,CAAC,MAAM,GAAG,MAAM,CAAA;OACvD;;;;MAKD,OAAO;UACL,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAA;UACzC,MAAM,OAAO,GAAG,QAAQ,CAAC,cAAc,CAAC,eAAe,CAAC,CAAA;UACxD,OAAO,IAAI,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAA;OAC9C;;;ECpFH;EAEA,MAAM,oBAAqB,SAAQ,iBAAiB;MAOlD;UACE,KAAK,CAAC,QAAQ,CAAC,CAAA;OAChB;;;;;MAMD,MAAM,kBAAkB,CAAC,OAAe;UACtC,IAAI,aAAa,CAAC,kBAAkB,CAAC,MAAM,EAAE;cAC3C,OAAM;WACP;;UAED,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,YAAY,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAA;;UAE1D,MAAM,MAAM,GAAI,MAAc,CAAC,QAAQ,CAAC,CAAC;UACzC,aAAa,CAAC,kBAAkB,CAAC,MAAM,GAAG,IAAI,CAAA;UAC9C,aAAa,CAAC,kBAAkB,CAAC,WAAW,GAAG,IAAI,CAAA;UAEnD,OAAO,MAAM,CAAA;OACd;;;;MAKD,aAAa;;OAGZ;MAED,QAAQ,CAAC,MAAkB;UACzB,MAAM,IAAI,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAA;UAC1C,IAAI,CAAC,EAAE,GAAG,MAAM,CAAA;UAChB,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAA;;UAE/B,MAAM,UAAU,GAAiC;cAC/C,IAAI,EAAE,MAAM,CAAC,IAAI;cACjB,KAAK,EAAE,MAAM,CAAC,UAAU;cACxB,MAAM,EAAE,MAAM,CAAC,WAAW;cAC1B,UAAU,EAAE,CAAC;cACb,SAAS,EAAE,IAAI;cACf,WAAW,EAAE,IAAI;cACjB,MAAM,EAAE,IAAI;cACZ,KAAK,EAAE,MAAM;cACb,KAAK,EAAE;kBACL,IAAI,EAAE,MAAM,CAAC,KAAK,CAAC,GAAG;kBACtB,UAAU,EAAE,MAAM,CAAC,KAAK,CAAC,WAAW;eACrC;WACF,CAAA;;UAGD,MAAM,IAAI,GAAG,IAAI,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAA;UAExC,OAAQ,IAAY,CAAA;OACrB;;;;MAKD,eAAe,CAAC,MAAkB;UAChC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;cAClB,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,CAAA;cAC1D,MAAM,CAAC,GAAG,EAAE,CAAA;WACb;UAED,IAAI,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,OAAO,CAAC,CAAA;UAC5C,MAAM,IAAI,MAAM,CAAC,YAAY,CAAC,OAAO,EAAE,gBAAgB,CAAC,CAAA;UAExD,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,KAAK;cACjC,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAE,MAAc,EAAE,GAAG,EAAE,CAAC,IAAI,EAAE,MAAM,CAAC,KAAK,CAAC,CAAC,CAAA;WACrF,CAAC,CAAA;OACH;;;;;MAOD,OAAO;UACL,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;cAClB,OAAM;WACP;UAED,IAAI,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,OAAO,CAAC,CAAA;UAC5C,MAAM,IAAI,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,CAAA;UAC3C,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;UAC5B,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,iBAAiB,CAAC,aAAa,CAAC,CAAA;OACvD;;;EChGH;;;;;;EAOA,eAAe,kBAAkB,CAAC,OAAe,EAAE,OAAe;MAChE,MAAM,WAAW,GAAQ;UACvB,GAAG,EAAE,iBAAiB;UACtB,MAAM,EAAE,oBAAoB;OAC7B,CAAA;MAED,MAAM,OAAO,GAA2B,IAAI,WAAW,CAAC,OAAO,CAAC,EAAE,CAAC;MAEnE,MAAM,OAAO,CAAC,kBAAkB,CAAC,OAAO,CAAC,CAAC;MAE1C,OAAO,CAAC,QAAQ,GAAG,OAAO,CAAC,aAAa,CAAC,OAAO,CAAC,CAAA;MAGjD,OAAO,OAAO,CAAA;EAChB;;ECzBA,SAAS,IAAI,CAAC,GAAW,EAAE,UAA+B;;MAExD,KAAK,MAAM,IAAI,IAAI,GAAG,EAAE;UACtB,IAAI,GAAG,CAAC,cAAc,CAAC,IAAI,CAAC,EAAE;cAC5B,UAAU,CAAC,IAAI,CAAC,CAAC;WAClB;OACF;EACH,CAAC;QAOoB,eAAe;MAgBlC,YAAY,IAAY;UAXxB,SAAI,GAAW,UAAU,CAAC;UAE1B,mBAAc,GAAG,IAAI,CAAC;UAId,mBAAc,GAAgB,EAAE,CAAC;;UAGlC,aAAQ,GAAkB,EAAE,CAAA;UAGjC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;UACjB,IAAI,CAAC,KAAK,GAAG,MAAM,CAAC;OACrB;MAED,MAAM;UACJ,MAAM,OAAO,GAAQ,MAAM,CAAA;;UAG3B,IAAI,CAAC,cAAc,GAAG,EAAY,CAAC;UACnC,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC;UAEtE,CAAC,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;UAEnE,IAAI,CAAC,OAAO,EAAE,IAAI;cAChB,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC;WAC3C,CAAC,CAAC;;UAGH,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAM;cACzD,OAAO,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;WAChD,CAAC,CAAC;UAEH,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC;OAC5B;MAED,QAAQ;UACN,MAAM,OAAO,GAAQ,MAAM,CAAA;UAC3B,IAAG,CAAC,IAAI,CAAC,cAAc,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE;cACrC,OAAM;WACP;UAED,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC;UAEpC,IAAI,CAAC,MAAM,EAAE,IAAI;cACf,IAAI,OAAO,CAAC,IAAI,CAAC,KAAK,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,EAAE;;kBAE/C,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC;kBACrD,OAAO,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC;eAC3C;WACF,CAAC,CAAC;UAEH,IAAI,OAAO,CAAC,GAAG,CAAC,QAAQ,KAAK,aAAa,EAAE;cAC1C,OAAO,CAAC,IAAI,CAAC,YAAY,IAAI,CAAC,IAAI,2BAA2B,EAAE,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;WAC7G;UAED,IAAI,CAAC,cAAc,GAAG,KAAK,CAAC;OAC7B;;;EC7EH,MAAM,iBAAiB,GAAG,MAAM,CAAC,WAAW,CAAC;EAC7C,MAAM,sBAAsB,GAAG,MAAM,CAAC,aAAa,CAAC;EAEnD,MAAc,CAAC,SAAS,GAAG,EAAE,CAAC;WAEf,aAAa,CAAC,MAAc;MAC1C,MAAM,OAAO,GAAQ,MAAM,CAAA;MAE3B,MAAM,CAAC,aAAa,GAAG,CAAC,UAAkB;UACxC,OAAO,CAAC,SAAS,GAAG,OAAO,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,EAAU,KAAK,EAAE,KAAK,UAAU,CAAC,CAAC;UAChF,OAAO,sBAAsB,CAAC,UAAU,CAAC,CAAC;OAC3C,CAAC;MAEF,MAAM,CAAC,WAAW,GAAG,CAAC,OAAiB,EAAE,OAAgB,EAAE,GAAG,IAAW;UACvE,MAAM,UAAU,GAAG,iBAAiB,CAAC,OAAO,EAAE,OAAO,EAAE,GAAG,IAAI,CAAC,CAAC;UAEhE,OAAO,CAAC,GAAG,CAAC,YAAY,EAAE,UAAU,CAAC,CAAC;UAEtC,IAAG,CAAC,OAAO,CAAC,SAAS,CAAC,QAAQ,CAAC,UAAU,CAAC,EAAE;cAC1C,OAAO,CAAC,SAAS,GAAG,CAAC,GAAG,OAAO,CAAC,SAAS,EAAE,UAAU,CAAC,CAAC;WACxD;UAED,OAAO,UAAU,CAAC;OACnB,CAAC;MAEF,OAAO,SAAS,IAAI;UAClB,OAAO,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,EAAU;cACnC,MAAM,CAAC,aAAa,CAAC,EAAE,CAAC,CAAA;WACzB,CAAC,CAAC;OACJ,CAAC;EACJ;;ECpBA;;;EAGO,eAAe,SAAS,CAAC,GAAY,EAAE,OAAwB,EAAE,MAAiE;MACvI,IAAI,aAAiC,CAAC;MAEtC,MAAM,cAAc,GAAG,GAAG,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC,KAAK,GAAG,GAAG,CAAC,MAAM,GAAG,GAAG,CAAC,KAAK,CAAC;;MAG1F,aAAa,GAAG,MAAM,UAAU,CAAC,cAAc,CAAC,CAAC;;MAGjD,IAAG,CAAC,OAAO,CAAC,QAAQ,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE;UACxC,OAAO,CAAC,IAAI,GAAG,GAAG,CAAC,IAAI,CAAA;UACvB,OAAO,CAAC,MAAM,EAAE,CAAA;OACjB;;MAGD,aAAa,CAAC,kBAAkB,GAAG,MAAM,MAAM,CAAC,GAAG,CAAC,MAAM,EAAE,aAAa,CAAC,aAAa,CAAC,CAAC;MAEzF,WAAW,CAAC,GAAG,CAAC,MAAM,GAAG,GAAG,CAAC,KAAK,CAAC,CAAC;;MAGpC,OAAO,KAAK,CAAC,GAAG,EAAE,OAAO,CAAC,CAAA;EAC5B,CAAC;EAED;;;;EAIO,eAAe,KAAK,CAAC,GAAY,EAAE,OAAwB;MAChE,MAAM,OAAO,GAAG,aAAa,CAAC,aAAa,CAAA;;MAG3C,IAAG,GAAG,CAAC,MAAM,KAAK,KAAK,EAAE;UACvB,aAAa,CAAC,kBAAkB,GAAG,GAAG,CAAA;UACtC,OAAO,CAAC,IAAI,GAAG,GAAG,CAAC,IAAI,CAAA;UACvB,OAAO,CAAC,MAAM,EAAE,CAAA;OACjB;MAED,GAAG,CAAC,eAAe,CAAC,GAAG,KAAK,MAAM,OAAO,CAAC,GAAG,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC,CAAA;MAEnE,IAAG,GAAG,CAAC,IAAI,KAAK,aAAa,CAAC,kBAAkB,CAAC,IAAI,EAAG;;UAEtD,aAAa,CAAC,kBAAkB,CAAC,IAAI,IAAI,aAAa,CAAC,kBAAkB,CAAC,IAAI,CAAE,OAA6B,EAAE,aAAa,CAAC,aAAa,CAAC,CAAA;OAC5I;MAED,GAAG,CAAC,MAAM,GAAG,KAAK,CAAA;MAElB,OAAO,GAAG,CAAA;EACZ,CAAC;EAED;;;;EAIO,eAAe,OAAO,CAAC,IAAoB,EAAE,OAAwB,EAAE,IAAY;MACxF,OAAO,IAAI,OAAO,CAAO,CAAC,OAAO;UAC/B,IAAG,CAAC,IAAI,EAAE;cAAE,OAAO,EAAE,CAAA;WAAE;;UAGvB,KAAI,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;cACnC,IAAG,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,eAAe,CAAC,EAAE;kBAAE,SAAQ;;cAE5C,KAAI,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,eAAe,CAAC,EAAE,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;kBAC7D,WAAW,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,eAAe,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAA;eAC/C;cAED,KAAI,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,eAAe,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;kBAC9D,WAAW,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAA;eAChD;cAED,IAAG,IAAI,KAAK,MAAM,EAAE;kBAClB,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,eAAe,CAAC,EAAE,GAAG,EAAE,CAAA;;kBAEnC,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,MAAM,GAAG,OAAO,CAAC;eAC9B;WAEF;UAED,OAAO,CAAC,QAAQ,EAAE,CAAA;UAElB,OAAO,EAAE,CAAA;OACV,CAAC,CAAA;EACJ;;EChFA,IAAK,UAGJ;EAHD,WAAK,UAAU;MACb,qCAAuB,CAAA;MACvB,+BAAiB,CAAA;EACnB,CAAC,EAHI,UAAU,KAAV,UAAU,QAGd;EAID,MAAM,YAAY,GAAG,EAAE,SAAS,EAAE,KAAK,EAAE,CAAA;EAEzC,IAAI,OAAO,GAAG,IAAI,CAAA;EAElB,MAAM,MAAM;MAkBV;;UAhBO,kBAAa,GAAY,IAAI,CAAC;;UAE9B,YAAO,GAAmB,EAAE,CAAC;;UAE7B,QAAG,GAAY,IAAI,CAAC,CAAC,CAAC,CAAC;;UAIvB,SAAI,GAAW,OAAO,CAAA;UAS3B,MAAM,MAAM,GAAe,MAAM,CAAA;UAEjC,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC,MAAM,GAAG,IAAI,MAAM,EAAE,CAAC;UAC3C,IAAI,CAAC,OAAO,GAAG,IAAI,eAAe,CAAC,EAAE,CAAC,CAAA;UAEtC,cAAc,CAAC,MAAM,CAAC,CAAA;UAEtB,IAAI,CAAC,IAAI,GAAG,aAAa,CAAC,MAAM,CAAC,CAAA;OAClC;;;;;MAMM,IAAI,CAAC,IAAwB;UAClC,IAAI,CAAC,GAAG,CAAC,CAAC,IAAI,EAAE,KAAK;cACnB,IAAI,CAAC,MAAM,GAAG,SAAS,CAAA;WACxB,CAAC,CAAA;UAEF,IAAI,CAAC,OAAO,GAAI,IAAkB,CAAA;UAElC,OAAO,IAAI,CAAC,OAAO,CAAA;OACpB;;;;;;MAOD,MAAM,gBAAgB,CAAC,IAAoB;;UAEzC,MAAM,SAAS,GAAG,oBAAoB,CAAC,IAAI,CAAC,CAAC;UAE7C,IAAG,CAAC,SAAS,EAAE;cACb,MAAM,IAAI,KAAK,CAAC,WAAW,CAAC,CAAC;WAE9B;UAED,IAAI,CAAC,GAAG,GAAG,SAAS,CAAC,GAAG,CAAA;UAExB,IAAI,CAAC,GAAG,CAAC,eAAe,GAAG,IAAI,CAAC,GAAG,CAAC,eAAe,IAAI,EAAE,EAAE,EAAE,EAAE,EAAE,GAAG,EAAE,EAAE,EAAE,CAAA;;UAG1E,MAAM,WAAW,GAAG,qBAAqB,CAAC,IAAI,CAAC,CAAC;;UAGhD,IAAG,CAAC,OAAO,EAAE;cACX,IAAI,CAAC,IAAI,EAAE,CAAA;WACZ;UAED,OAAO,GAAG,KAAK,CAAA;UACf,IAAG,WAAW,EAAE;cACd,MAAM,OAAO,CAAC,WAAW,EAAE,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,IAAI,CAAC,CAAA;WACpD;UAED,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,gBAAgB,CAAC,CAAA;UAGpC,IAAG,IAAI,CAAC,GAAG,CAAC,MAAM,KAAK,KAAK,EAAE;cAC5B,aAAa,CAAC,kBAAkB,GAAG,IAAI,CAAC,GAAG,CAAA;WAC5C;;UAGD,IAAG,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE;cACjB,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,UAAU,CAAC,CAAA;WAC/B;UAED,aAAa,CAAC,aAAa,GAAG,MAAM,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;;UAGrE,MAAM,UAAU,GAAG,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,iBAAiB,EAAE,CAAC;UAEvD,IAAI,CAAC,GAAG,GAAG,MAAM,YAAY,CAAE,UAAyB,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAA;;UAG9G,IAAI,CAAC,GAAG,GAAG,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,EAAE,aAAa,CAAC,aAAa,EAAG,aAAa,CAAC,kBAAkB,CAAC,CAAA;UAElG,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC,GAAG,CAAA;UAEhC,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,UAAU,CAAC,CAAA;OAC/B;;;;MAMM,MAAM,iBAAiB,CAAC,aAAiC;UAC9D,IAAG,CAAC,aAAa,EAAE;cACjB,OAAO,aAAa,CAAC,aAAa,CAAA;WACnC;;UAGD,IAAI,OAAO,GAA2B,aAAa,CAAC,aAAa,CAAC;;UAGlE,IAAG,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,IAAI,IAAI,CAAC,GAAG,CAAC,OAAO,KAAK,aAAa,CAAC,aAAa,CAAC,OAAO,EAAE;cAEhF,aAAa,CAAC,OAAO;kBACrB,MAAM,CAAC,MAAM,CAAC,aAAa,CAAC,aAAa,EAAE;sBACzC,OAAO,EAAE,aAAa,CAAC,OAAO,EAAE,OAAO,EAAE,aAAa,CAAC,OAAO;mBAC/D,CAAC,CAAA;;cAGF,IAAG,OAAO,IAAI,OAAO,CAAC,OAAO,EAAE;kBAC7B,OAAO,CAAC,OAAO,EAAE,CAAA;eAElB;;cAGD,OAAO,GAAG,aAAa,CAAC,aAAa,GAAG,MAAM,kBAAkB,CAAC,aAAa,CAAC,aAAa,CAAC,OAAO,EAAE,aAAa,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC;WAC5I;eAAK;;cAGJ,OAAO,GAAG,aAAa,CAAC,aAAa,CAAA;WACtC;UAED,OAAO,OAAO,CAAA;OACf;;;;MAKD,MAAM,WAAW,CAAC,UAAkB,EAAE,UAAe;;UAEnD,KAAI,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,UAAU,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;cAEzC,IAAG,QAAO,UAAU,CAAC,CAAC,CAAC,CAAC,KAAK,QAAQ,EAAE;kBACrC,MAAM,KAAK,GAAG,UAAU,CAAC,CAAC,CAAC,CAAA;kBAC3B,MAAM,GAAG,GAAG,UAAU,GAAG,GAAG,GAAG,KAAK,CAAA;kBAGpC,IAAG,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,EAAE;sBAE7B,IAAI,CAAC,GAAG,CAAC,eAAe,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;0BAC9C,IAAI,CAAC,GAAG,CAAC,eAAe,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;sBACxC,SAAQ;mBACT;uBAAK,IAAG,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,EAAC;sBACjC,MAAM,UAAU,CAAC,GAAG,CAAC,CAAA;mBACtB;uBAAK;sBACJ,IAAI,MAAM,GAAG,IAAI,KAAK,EAAE,CAAA;sBACxB,MAAM,CAAC,GAAG,GAAG,GAAG,CAAA;mBACjB;kBAED,IAAG,IAAI,CAAC,IAAI,KAAK,MAAM,EAAE;sBACvB,IAAI,CAAC,GAAG,CAAC,eAAe,CAAC,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;mBACtC;kBAED,SAAQ;eACT;WACF;UAED,OAAO,aAAa,CAAC,kBAAkB,CAAA;OACxC;;;;;MAMM,eAAe;UACpB,OAAO,CAAC,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;OAC3B;MAEM,KAAK;UACV,QAAQ,CAAC,MAAM,EAAE,MAAM,CAAC,CAAA;UACxB,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAA;OACpC;;;EChNI,MAAM,wBAAwB,GAAG;MACtC,UAAU,EAAE,YAAY;GACzB,CAAA;EAED,MAAM,qBAAqB,GAAQ;MACjC,UAAU,EAAE,EAAE;MACd,YAAY,EAAE,EAAE;GACjB,CAAA;WAgCe,0BAA0B,CAAC,SAAiB,EAAE,EAAO;MACnE,OAAO,IAAI,CAAC,qBAAqB,CAAC,SAAS,CAAC,EAAE,EAAE,CAAC,CAAC;EACpD,CAAC;WAEe,yBAAyB,CAAC,SAAiB,EAAE,EAAO;MAClE,qBAAqB,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;EAC5C,CAAC;WAEe,4BAA4B,CAAC,SAAiB,EAAE,UAAe;MAC7E,qBAAqB,CAAC,SAAS,CAAC,GAAG,qBAAqB,CAAC,SAAS,CAAC,CAAC,MAAM,CACxE,CAAC,EAAO,KAAK,EAAE,KAAK,UAAU,CAC/B,CAAC;EACJ,CAAC;WAEe,IAAI,CAAC,IAAgB,EAAE,OAAY;MACjD,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;UACxB,OAAO,KAAK,CAAC;OACd;MAED,OAAO,IAAI,CAAC,MAAM,CAAC,IAAI,IAAI,IAAI,KAAK,OAAO,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC;EAC1D;;ECvDA;EACA,MAAM,wBAAwB,GAAG,MAAM,CAAC,gBAAgB,CAAC;EACzD,MAAM,yBAAyB,GAAG,MAAM,CAAC,mBAAmB,CAAC;EAC7D,MAAM,iBAAiB,GAAG,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC;EACnD,MAAM,oBAAoB,GAAG,MAAM,CAAC,OAAO,CAAC,YAAY,CAAC;EAEzD,MAAM,MAAM;MAEV,YAAY,MAAc;UACxB,IAAI,CAAC,MAAM,GAAG,MAAM,CAAA;UAEpB,IAAI,CAAC,aAAa,EAAE,CAAC;UACrB,IAAI,CAAC,mBAAmB,EAAE,CAAC;OAC5B;MAED,OAAO;UACL,IAAI,CAAC,MAAM,CAAC,GAAG,IAAI,IAAI,CAAC,MAAM,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAA;OACtD;MAED,IAAI,CAAC,GAAW;;;;UAKd,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC,IAAI,EAAE,EAAE,EAAE,GAAG,CAAC,CAAA;OACxC;MAED,aAAa;UACX,MAAM,EAAE,GAAG,IAAI,CAAA;UACf,MAAM,CAAC,OAAO,CAAC,SAAS,GAAG,UAAU,KAAU,EAAE,KAAa,EAAE,GAA8B,EAAE,GAAG,IAAI;cACrG,IAAI,MAAM,GAAG,iBAAiB,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC,KAAK,EAAE,KAAK,EAAE,GAAG,CAAC,CAAC,CAAC;cAChE,EAAE,CAAC,OAAO,EAAE,CAAA;cACZ,OAAO,MAAM,CAAA;WACd,CAAA;UAED,MAAM,CAAC,OAAO,CAAC,YAAY,GAAG,UAAU,KAAU,EAAE,KAAa,EAAE,GAA8B,EAAE,GAAG,IAAI;cACxG,IAAI,MAAM,GAAG,oBAAoB,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC,KAAK,EAAE,KAAK,EAAE,GAAG,CAAC,CAAC,CAAA;cAClE,EAAE,CAAC,OAAO,EAAE,CAAC;cACb,OAAO,MAAM,CAAC;WACf,CAAA;UAED,MAAM,CAAC,UAAU,GAAG,CAAC,KAAoB;cAEvC,EAAE,CAAC,OAAO,EAAE,CAAC;WACd,CAAA;UAED,MAAM,CAAC,gBAAgB,CAAC,UAAU,EAAE;cAClC,EAAE,CAAC,OAAO,EAAE,CAAC;WACd,EAAE,KAAK,CAAC,CAAC;OACX;;MAED,mBAAmB;UACjB,MAAM,CAAC,gBAAgB,GAAG,CAAC,SAAiB,EAAE,EAAsC,EAAE,MAA0C;cAC9H,IACE,OAAO,EAAE,KAAK,UAAU;kBACxB,wBAAwB,CAAC,OAAO,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;kBAChD,CAAC,0BAA0B,CAAC,SAAS,EAAE,EAAE,CAAC,EAC1C;kBACA,yBAAyB,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;kBACzC,OAAO;eACR;cAED,OAAO,wBAAwB,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC,SAAS,EAAE,EAAE,EAAE,MAAM,CAAC,CAAC,CAAC;WAExE,CAAA;UAED,MAAM,CAAC,mBAAmB,GAAG,CAAC,SAAiB,EAAE,EAAsC,EAAE,MAA0C;cACjI,IAAI,OAAO,EAAE,KAAK,UAAU,IAAI,wBAAwB,CAAC,OAAO,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE;kBAChF,4BAA4B,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;kBAC5C,OAAO;eACR;cAED,OAAO,yBAAyB,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC,SAAS,EAAE,EAAE,EAAE,MAAM,CAAC,CAAC,CAAC;WACzE,CAAC;OACH;MAED,cAAc,CAAC,KAAoB;OAElC;;;QC7EG,MAAM,GAAG,IAAI,MAAM,GAAE;QACrB,MAAM,GAAG,IAAI,MAAM,CAAC,MAAM,EAAC;EAIjC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC;;;;;;;;;;;;;;"}