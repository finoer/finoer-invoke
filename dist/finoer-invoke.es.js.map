{"version":3,"file":"finoer-invoke.es.js","sources":["../src/applycation/store.ts","../src/applycation/register.ts","../../finoer-store/src/utils/index.ts","../src/global/index.ts","../src/utils/contants.ts","../src/utils/index.ts","../src/events/index.ts","../src/loader/index.ts","../src/context/base.ts","../src/context/vue.ts","../src/context/phaser.ts","../src/context/init.ts","../src/sandbox/snapshot.ts","../src/sandbox/patchAtMounting.ts","../src/invoke/index.ts","../src/router/capturedListeners.ts","../src/router/index.ts","../src/index.ts"],"sourcesContent":["\nconst namespace = 'FINO'\n\nexport function setStore(key: string, value: any) {\n  if (!(window as any)[namespace]) {\n    (window as any)[namespace] = {};\n  }\n  (window as any)[namespace][key] = value;\n}\n\nexport function getStore(key: string) {\n  const fino: any = (window as any)[namespace];\n  return fino && fino[key] ? fino[key] : null;\n}\n","import { Project, BaseProject } from \"../types/project\"\nimport { invoke } from \"..\"\nimport { setStore } from \"./store\";\n\nexport let Apps: Array<Project> = []\n\nexport function registerApps(app: Array<BaseProject>): Array<Project> {\n\n  setStore('root', 'root')\n  Apps = invoke.init(app)\n\n  return Apps\n}\n","import Database from \"../database\"\n\n// 判断是否是一个对象\nexport const isObject = (obj: unknown) => typeof(obj) === 'object' && obj !== null\n\nexport function isKeywordInThis(key: string) {\n  const instance = new Database()\n  let keys = Object.keys(instance)\n\n  return keys.includes(key)\n}\n","// import apps from \"../model\"\nimport Vue from 'vue'\nimport { Project } from \"../types/project\"\nimport { VueConstructor } from \"vue/types/umd\"\nimport { Apps } from '../applycation/register'\nimport { GlobalType } from '../types/context'\nimport { AppInfoType } from '../types/project/appInfo'\n// import Database from '../../../fino-database'\n\ninterface CacheType {\n  [propsName:string]: boolean;\n}\n/**\n * @class 全局单例\n */\nexport class GlobalContext {\n  // 当前正在运行的子模块\n  public activedApplication: Project\n\n  // 当前需要加载的子模块\n  public activeAppInfo: AppInfoType = {\n    app: '',\n    context: '',\n    version: ''\n  }\n\n  // 资源缓存\n  public contextSourceCache: CacheType = {};\n\n  // 当前运行环境\n  public activeContext: VueConstructor<Vue> | Window | any\n\n  constructor() {\n    this.activedApplication = Apps[0]\n\n    this.activeContext = Window\n  }\n\n  // 设置运行环境\n  public setRuntimeContext<RuntimeContextType>(context: RuntimeContextType) {\n    this.activeContext = context\n  }\n}\n\n\n\nfunction getGlobalContext() {\n  const global: GlobalType = window;\n\n  if(global.globalContext) {\n    return global.globalContext;\n  }\n\n  global.globalContext = new GlobalContext()\n  // debugger\n  // console.log('database', Database)\n  // global.$data = new Database()\n\n  return global.globalContext\n}\n\nexport const globalContext = getGlobalContext()\n\n\n\n","export const PEDEST_STARTED = \"PEDEST_STARTED\"\n\n\nexport const PEDEST_NOT_STARTED = \"PEDEST_NOT_STARTED\"\n\nexport const BOOTSTRAP = 'BOOTSTRAP';\n\nexport const MOUNT = 'MOUNT'\n\nexport const MOUNTED = 'MOUNTED'\n\nexport const UNMOUNT = 'UNMOUNT'\n\n","import { Project } from \"../types/project\";\n// import apps from '../model/index'\nimport { globalContext } from \"../global\";\nimport { GlobalType, MatchAppType } from \"../types/context\";\nimport { BOOTSTRAP, MOUNT, UNMOUNT } from \"./contants\";\n\n\n/**\n * @function 获取当前应该被加载的应用\n * @param { apps - 应用列表 }\n * @return { app - 需要被加载的应用 }\n */\nexport function getAppShouldBeActive(apps: Array<Project>): MatchAppType {\n  let result: MatchAppType = { app: apps[0], index: 0 };\n  apps.forEach((item, index) => {\n    if (item.activeWhen(window.location) && item.status ) {\n      item.status === UNMOUNT && (item.status = BOOTSTRAP);\n      result = {\n        app: item,\n        index: index\n      }\n    }\n  })\n  return result\n}\n\n/**\n * @function 获取当前应该被卸载的应用\n * @param global\n * @param { apps - 应用列表 }\n * @return { app - 需要被加载的应用 }\n */\nexport function getAppShouldBeUnmount(apps: Array<Project>): Array<MatchAppType> {\n  let result: MatchAppType[] = [];\n\n  apps.forEach((item, index) => {\n    if (!item.activeWhen(window.location) && item.status === MOUNT) {\n      result.push({\n        app: item,\n        index: index\n      })\n    }\n  })\n  return result\n}\n\n// 判断是否是一个对象\nexport const isObject = (obj: unknown) => typeof(obj) === 'object' && obj !== null\n\n\n/**\n * @func 进入loading模式\n * @parans { show - 是否展示loading }\n */\n\n// 卸载标签\nexport function removeChild(id: string) {\n  let element = document.getElementById(id);\n  element && document.body.removeChild(element);\n}\n\n\nexport function registerEvents(global: GlobalType) {\n  if (!global.$event) { return }\n  global.$event.subscribe('baseInfoLoaded', baseInfoLoaded);\n  global.$event.subscribe('childAppLoaded', childAppLoaded);\n}\n\n\nexport function getAppMountTime(app: Project) {\n  try {\n    return app.activeWhen(window.location);\n  } catch (e) {\n    throw e;\n  }\n}\n\nexport function firstUpperCase(str: string) {\n  return str.toLowerCase().replace(/(|^)[a-z]/g, (L) => L.toUpperCase());\n}\n\nfunction baseInfoLoaded(data: any) {\n  globalContext.activeAppInfo = data\n  return data\n}\n\nfunction childAppLoaded(data: any) {\n  globalContext.activedApplication = data\n  return data\n}\n\n","interface EventsArray {\n\t[key: string]: any;\n}\n\nclass Events {\n\t// 事件池\n\tprivate _events: EventsArray = {};\n\n\t/**\n     * 添加订阅方法\n     * @param type 订阅事件的类型（名字）\n     * @param listener 订阅事件的回调\n     * @param flay 插入顺序\n     */\n    subscribe(type: string, listener: (data: any) => any | any, flag?: boolean) {\n\t\t// 如果订阅的事件在事件池里面存在\n\n\t\tif(this._events[type]) {\n\t\t\tif(this._events[type].indexOf(listener) > -1) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tflag ?\n\t\t\t\tthis._events[type].unshift(listener) :\n\t\t\t\tthis._events[type].push(listener);\n\n\t\t\treturn;\n\t\t}\n\n\n\t\tthis._events[type] = [listener];\n\t}\n\n\t/**\n     * 通知消息\n     * @param type 需要分发的事件的名字\n     * @param args 回调函数的参数\n     */\n    notify(type: string, args?: string[] | undefined | any ) {\n\n\t\tlet argument = args || [];\n\n        if(this._events[type]) {\n            this._events[type].forEach((fn: any) => fn.call(this, argument));\n        }\n    }\n\n    /**\n     * 移除当前绑定的事件\n     * @param type 事件类型\n     * @param listener 事件回调函数\n     */\n    removeListener(type: string, listener: any) {\n        if(this._events[type]) {\n            this._events[type].filter((fn: any) => {\n                return fn !== listener && fn.orign !== listener\n            })\n        }\n    }\n\n    /**\n     * 优先执行订阅\n     * @param type\n     * @param listener\n     */\n    prepend(type: string, listener: any) {\n        this.subscribe(type, listener, true)\n    }\n}\n\nexport default Events\n","const baseUrl: string = \"\";\n\nexport enum AssetTypeEnum {\n  INLINE = 'inline',\n  EXTERNAL = 'external',\n}\n\nexport interface Asset {\n  type: AssetTypeEnum;\n  content: string;\n}\n\n\n\nexport function ajaxLoadJs(src: string): Promise<any> {\n  return new Promise(() => {\n    window.fetch(src).then(res => {\n\n      res.text()\n    });\n  })\n\n}\n\nexport function tagLoadJs(src: string): Promise<any> {\n  let { scriptTag, timestamp } = createJs();\n  return new Promise((resolve, reject) => {\n    scriptTag.onload = () => resolve();\n\n    scriptTag.onerror = (err) => {\n      setTimeout(() => {\n        document.head.removeChild(scriptTag)\n        let s2 = createJs()\n        s2.scriptTag.onload = resolve\n        s2.scriptTag.onerror = reject\n        s2.scriptTag.src = baseUrl + src + \"?\" + timestamp\n        document.head.appendChild(s2.scriptTag)\n        reject(err)\n      }, 1000)\n    }\n\n    scriptTag.src = baseUrl + src + \"?\" + timestamp\n    scriptTag.id = baseUrl + src\n    document.body.appendChild(scriptTag)\n  })\n}\n\nexport function tagLoadCss(link: string): Promise<any> {\n  let { styleTag, timestamp } = createCss();\n  return new Promise((resolve) => {\n    styleTag.onload = () => resolve();\n\n    styleTag.href = baseUrl + link + \"?\" + timestamp\n    styleTag.rel = \"stylesheet\"\n    styleTag.id = baseUrl + link\n    document.body.appendChild(styleTag)\n  })\n}\n\nfunction createCss() {\n  const styleTag: HTMLLinkElement = document.createElement('link')\n  const timestamp = + new Date();\n\n  styleTag.id = \"timestamp\"\n\n  return {\n    styleTag,\n    timestamp\n  }\n}\n\n\nfunction createJs() {\n  const scriptTag: HTMLScriptElement = document.createElement('script')\n  const timestamp = + new Date();\n\n  scriptTag.type = \"text/javascript\"\n  scriptTag.id = \"timestamp\"\n\n  return {\n    scriptTag,\n    timestamp\n  }\n}\n","\n/**\n * @class 管理子模块的运行环境\n * @mehtods {*} createContext\n * @mehtods {*} loadContext\n * @mehtods {*} unmountContext\n */\n\nimport { tagLoadJs } from \"../loader\";\n\nabstract class BaseModuleContext {\n  // 资源的base url\n  public baseUrl: string = `https://cdn.bootcdn.net/ajax/libs`;\n\n  public context: string = \"\"\n\n  constructor(type: string) {\n    this.context = type\n  }\n\n  // 获取运行环境沙箱\n  public getSandBoxJs(type: string, version: string) {\n    const url = `${this.baseUrl}/${type}/${version}/${type}.min.js`;\n    return tagLoadJs(url)\n  }\n\n  abstract createContext(version: string): any\n\n  abstract destroy(): void\n}\n\nexport default BaseModuleContext\n","import BaseModuleContext from \"./base\";\n\nimport { CreateElement } from \"vue/types/umd\";\nimport { globalContext } from \"../global\";\n\ninterface Global extends Window {\n  vue?: Vue,\n  VueRouter?: any,\n}\n\nclass VueRuntimeContext extends BaseModuleContext {\n  // the instance of runtime context\n  public instance?: Vue\n\n  constructor() {\n    super(\"vue\")\n  }\n\n  /**\n   * @func { Get running environment resources }\n   * @param version\n   */\n  async getContextResource(version: string) {\n    if (globalContext.contextSourceCache.vue) {\n      return\n    }\n    // 获取当前运行环境所需的资源\n    const context = await this.getSandBoxJs('vue', version)\n    const routerLib = await this.getSandBoxJs('vue-router', '3.4.3')\n\n    globalContext.contextSourceCache.vue = true\n    globalContext.contextSourceCache.vueRouter = true\n\n    return context\n  }\n\n  /**\n   * @func {*} create vue runtime context\n   */\n  createContext(version: string) {\n    // create root node\n    let rootDom = document.createElement('div');\n    rootDom.setAttribute('id', 'fino-vue-root');\n    document.body.appendChild(rootDom);\n    (window as any)['Vue2'] = (window as any)['Vue'];\n    (window as any)['Vue'] = undefined;\n    const Vue = (window as any)['Vue2'];\n    const VueRouter = (window as any).VueRouter\n\n    Vue.use(VueRouter)\n    const router = new VueRouter({\n      mode: 'history',\n      routes: []\n    })\n\n    const vue = (window as any).vm = new (Vue as any)({\n      el: rootDom,\n      router,\n      render: (h: CreateElement) => h('div', { attrs: { id: 'fino-vue-root' } },\n        [\n          h('RouterView')\n        ]\n      )\n    })\n\n    return vue\n  }\n\n  /**\n   * @func { Injection router }\n   */\n  injectionRouter(routes: Array<any>) {\n    if (!this.instance) {\n      return\n    }\n\n    (this as any).instance.$router.addRoutes(routes);\n\n    (this as any).instance.$router.options.routes = routes\n  }\n\n  /**\n   * @func { Uninstall the runtime environment }\n   */\n  destroy() {\n    this.instance && this.instance.$destroy()\n    const element = document.getElementById('fino-vue-root')\n    element && document.body.removeChild(element)\n  }\n}\n\nexport default VueRuntimeContext\n","import BaseModuleContext from \"./base\";\nimport { tagLoadJs } from \"../loader\";\nimport { globalContext } from \"../global\";\n\n/// <reference path=\"../types/phaser.d.ts\" />\n\nclass PhaserRuntimeContext extends BaseModuleContext {\n  // 当前runtime\n  public instance?: Phaser.Game | null\n\n  // 实例\n  public element?: HTMLElement | null\n\n  constructor() {\n    super(\"phaser\")\n  }\n\n  /**\n   * @func 获取资源\n   * @param version\n   */\n  async getContextResource(version: string) {\n    if (globalContext.contextSourceCache.phaser) {\n      return\n    }\n    // 获取当前运行环境所需的资源\n    const context = await this.getSandBoxJs('phaser', version)\n    const plugin = await tagLoadJs('https://s.vipkidstatic.com/phaser/SpinePlugin.min.js')\n    //\n    const Phaser = (window as any)['Phaser'];\n    globalContext.contextSourceCache.phaser = true\n    globalContext.contextSourceCache.SpinePlugin = true\n\n    return Phaser\n  }\n\n  /**\n   * @func {*} Initialize the phaser operating environment\n   */\n  createContext() {\n    // phaser3.23不可以异步注入场景， 因此需要在注入路由的时候创建实例\n\n  }\n\n  initGame(scenes: Array<Phaser.Scene>) {\n    const root = document.createElement('div')\n    root.id = 'root'\n    document.body.appendChild(root)\n    // Create game instance\n    const gameConfig: Phaser.Types.Core.GameConfig = {\n      type: Phaser.AUTO,\n      width: window.innerWidth,\n      height: window.innerHeight,\n      resolution: 2,\n      autoFocus: true,\n      transparent: true,\n      parent: root,\n      scene: scenes,\n      plugins: {\n        scene: [\n          {\n            key: 'SpinePlugin',\n            plugin: (window as any)['SpinePlugin'],\n            mapping: 'spine'\n          }\n        ]\n      },\n      scale: {\n        mode: Phaser.Scale.FIT,\n        autoCenter: Phaser.Scale.CENTER_BOTH\n      },\n    }\n\n    // debugger\n    const game = new Phaser.Game(gameConfig)\n\n    return game\n  }\n\n  /**\n   * @func {*} injection routing\n   */\n  injectionRouter(scenes: Array<Phaser.Scene>,) {\n    if (!this.instance) {\n      this.instance = this.initGame([scenes[scenes.length - 1]])\n      scenes.pop()\n    }\n\n    let canvas = document.querySelector('#root')\n    canvas && canvas.setAttribute('style', `display: block`)\n\n    Object.keys(scenes).map((key, index) => {\n      this.instance && this.instance.scene.add((scenes as any)[(key)].name, scenes[index])\n    })\n  }\n\n\n  /**\n   * @func {*} destroy the current running instance\n   * @remark {}\n   */\n  destroy() {\n    if (!this.instance) {\n      return\n    }\n\n    let canvas = document.querySelector('#root')\n    canvas && document.body.removeChild(canvas)\n    this.instance.destroy(true);\n    this.instance.plugins.removeScenePlugin('SpinePlugin')\n  }\n}\n\nexport default PhaserRuntimeContext\n","import VueRuntimeContext from \"./vue\";\nimport { ContextType } from \"../types/context\";\nimport PhaserRuntimeContext from \"./phaser\";\n\n/**\n * @function { Initialize the runtime context }\n * @param { context - runtime context type: like vue }\n * @param { version - runtime context version: string }\n *\n */\n\nasync function initRuntimeContext(context: string, version: string): Promise<ContextType['context']> {\n  const runtimePool: any = {\n    vue: VueRuntimeContext,\n    phaser: PhaserRuntimeContext\n  }\n\n  const runtime: ContextType['context'] = new runtimePool[context]();\n\n  await runtime.getContextResource(version);\n\n  runtime.instance = runtime.createContext(version)\n\n\n  return runtime\n}\n\nexport default initRuntimeContext\n","function iter(obj: object, callbackFn: (prop: any) => void) {\n  // eslint-disable-next-line guard-for-in, no-restricted-syntax\n  for (const prop in obj) {\n    if (obj.hasOwnProperty(prop)) {\n      callbackFn(prop);\n    }\n  }\n}\n\ninterface ObjectProps {\n  [props: string]: Record<any, any>\n}\n\n\nexport default class SnapshotSandbox {\n  proxy: WindowProxy;\n\n  name: string;\n\n  type: string = 'Snapshot';\n\n  sandboxRunning = true;\n\n  private windowSnapshot!: Window | any;\n\n  private modifyPropsMap: ObjectProps = {};\n\n  // 缓存应用名字\n  public appCache: Array<string> = []\n\n  constructor(name: string) {\n    this.name = name;\n    this.proxy = window;\n  }\n\n  active() {\n    const _window: any = window\n\n    // 记录当前快照\n    this.windowSnapshot = {} as Window;\n    this.modifyPropsMap[this.name] = this.modifyPropsMap[this.name] || {};\n\n    !this.appCache.includes(this.name) && this.appCache.push(this.name)\n\n    iter(_window, prop => {\n      this.windowSnapshot[prop] = _window[prop];\n    });\n\n    // 恢复之前的变更\n    Object.keys(this.modifyPropsMap[this.name]).forEach((p: any) => {\n      _window[p] = this.modifyPropsMap[this.name][p];\n    });\n\n    this.sandboxRunning = true;\n  }\n\n  inactive() {\n    const _window: any = window\n    if(!this.windowSnapshot || !this.name) {\n      return\n    }\n\n    this.modifyPropsMap[this.name] = {};\n\n    iter(window, prop => {\n      if (_window[prop] !== this.windowSnapshot[prop]) {\n        // 记录变更，恢复环境\n        this.modifyPropsMap[this.name][prop] = _window[prop];\n        _window[prop] = this.windowSnapshot[prop];\n      }\n    });\n\n    if (process.env.NODE_ENV === 'development') {\n      console.info(`[qiankun:sandbox] ${this.name} origin window restore...`, Object.keys(this.modifyPropsMap[this.name]));\n    }\n\n    this.sandboxRunning = false;\n  }\n}\n","const rawWindowInterval = window.setInterval;\nconst rawWindowClearInterval = window.clearInterval;\n\n(window as any).intervals = [];\n\nexport function patchInterval(global: Window) {\n  const _window: any = window\n\n  global.clearInterval = (intervalId: number) => {\n    _window.intervals = _window.intervals.filter((id: number) => id !== intervalId);\n    return rawWindowClearInterval(intervalId);\n  };\n\n  global.setInterval = (handler: Function, timeout?: number, ...args: any[]) => {\n    const intervalId = rawWindowInterval(handler, timeout, ...args);\n\n    console.log('intervalId', intervalId);\n\n    if(!_window.intervals.includes(intervalId)) {\n      _window.intervals = [..._window.intervals, intervalId];\n    }\n\n    return intervalId;\n  };\n\n  return function free() {\n    _window.intervals.forEach((id: number) => {\n      global.clearInterval(id)\n    });\n  };\n}\n","import { Project, BaseProject } from \"../types/project\";\nimport { Apps } from \"../applycation/register\";\nimport { getStore, setStore } from \"../applycation/store\";\nimport { getAppShouldBeActive, getAppShouldBeUnmount, registerEvents, removeChild } from \"../utils\";\nimport { GlobalType, ContextType, MatchAppType } from '../types/context'\nimport Events from \"../events\";\nimport { tagLoadJs, tagLoadCss } from \"../loader\";\nimport { globalContext } from \"../global\";\nimport initRuntimeContext from \"../context/init\";\nimport VueRuntimeContext from \"../context/vue\";\nimport { BOOTSTRAP, MOUNTED, MOUNT, UNMOUNT } from \"../utils/contants\";\nimport SnapshotSandbox from \"../sandbox/snapshot\";\nimport { patchInterval } from \"../sandbox/patchAtMounting\";\n\nenum LifeCircle {\n  BOOTSTRAP = 'bootstrap',\n  MOUNTED = 'mount'\n}\n\nlet isFrist = true\n\nclass Invoke {\n  // Operating environment: whether to run on the base or the sub-module to run independently\n  public runtimeInfino: boolean = true;\n  // Application List\n  public appList: Array<Project> = [];\n  // Run submodule: the first one by default\n  public app: Project = Apps[0];\n  // Event\n  public $event: Events;\n\n  // sandbox\n  public sandbox: SnapshotSandbox\n\n  // interval\n  public free: any\n\n  constructor() {\n    const global: GlobalType = window\n\n    this.$event = global.$event = new Events();\n    this.sandbox = new SnapshotSandbox('')\n\n    registerEvents(global)\n\n    this.free = patchInterval(window)\n  }\n\n  /**\n   * @methods { Initialize the project list }\n   * @param apps { project list as array }\n   */\n  public init(apps: Array<BaseProject>) {\n    apps.map((item, index) => {\n      item.status = BOOTSTRAP\n    })\n\n    this.appList = (apps as Project[])\n\n    this.performAppChnage(this.appList)\n\n    return this.appList\n  }\n\n  /**\n   * @methods { Scheduling applications, uninstalling the runtime, and mounting new applications }\n   * @desc\n   * @params { - apps: Project child project list }\n   */\n  async performAppChnage(apps: Array<Project>) {\n    // Get the application that needs to be mounted\n    const activeApp = getAppShouldBeActive(apps);\n\n    // uninstall apps that do not require activation\n    const unmountApps = getAppShouldBeUnmount(apps);\n\n    // restore the sandbox environment\n    if(!isFrist) {\n      this.free()\n    }\n\n    isFrist = false\n    if(unmountApps) {\n      // await this.unmount(unmountApps)\n    }\n\n    this.app = activeApp.app\n\n    if(this.app.status === MOUNT) {\n      globalContext.activedApplication = this.app\n    }\n\n    // Trigger loading animation\n    if(!this.app.init) {\n      this.$event.notify('appLeave')\n    }\n\n    globalContext.activeContext = await this.setRuntimeContext(this.app);\n\n    // Get the life cycle function of the current application(bootstrap, mount)\n    const lifecircle = this.app.status.toLocaleLowerCase();\n\n    await this[(lifecircle as LifeCircle)]()\n\n    // At this time, the various information of the app is ready, merge the cached information to the current app\n    this.app = Object.assign(this.app, globalContext.activeAppInfo,  globalContext.activedApplication)\n\n    Apps[activeApp.index] = this.app\n\n    this.$event.notify('appEnter')\n  }\n\n  /**\n   * @methods { life cycle-bootstrap }\n   */\n  async bootstrap() {\n\n    // globalContext.activeAppInfo.context && this.sandbox.inactive()\n    // Get current application information\n    let activeProject: Project['appInfo'];\n\n    const entryStatePath = this.app.domain + this.app.entry;\n\n    // Get application js packaging information\n    activeProject = await this.getEntryJs(entryStatePath)\n\n    if(!this.sandbox.appCache.includes(this.app.name)) {\n      this.sandbox.name = this.app.name\n      this.sandbox.active()\n    }\n\n    // load application entry file { init: () => {}, name: string, destory: () => {} }\n    globalContext.activedApplication = await this.getModuleJs(this.app.domain, globalContext.activeAppInfo);\n\n    removeChild(this.app.domain + this.app.entry)\n    // Execute mount life cycle\n    await this.mount()\n  }\n\n  /**\n   * @methods The application is successfully mounted, and the sub-application is notified\n   */\n  public async setRuntimeContext(activeProject: Project['appInfo']): Promise<ContextType['context']> {\n    if(!activeProject) {\n      return globalContext.activeContext\n    }\n\n    // Create the runtime context\n    let runtime: ContextType['context'] = globalContext.activeContext;\n\n    // If the runtime context of the new application is different from the previous one, uninstall it\n    if(!this.app.context || this.app.context !== globalContext.activeContext.context) {\n\n      activeProject.context &&\n      Object.assign(globalContext.activeAppInfo, {\n        context: activeProject.context, version: activeProject.version\n      })\n\n      // uninstall before app runtime context,\n      if(runtime && runtime.destroy) {\n        runtime.destroy()\n\n      }\n\n      // store the created runtime environment in the global\n      runtime = globalContext.activeContext = await initRuntimeContext(globalContext.activeAppInfo.context, globalContext.activeAppInfo.version);\n    }else {\n\n      // If the runtime context is the same, reuse directly\n      runtime = globalContext.activeContext\n    }\n\n    return runtime\n  }\n\n  /**\n   * @methods { life cycle-mount }\n   * @des Create a running environment and inject routing\n   */\n  async mount() {\n    const runtime = globalContext.activeContext\n    // The runtime context is initialized successfully, and the route is injected\n\n    if(this.app.status === MOUNT) {\n      globalContext.activedApplication = this.app\n      this.sandbox.name = this.app.name\n      this.sandbox.active()\n    }\n\n    if(this.app.name === globalContext.activedApplication.name)  {\n      // injection router\n      globalContext.activedApplication.init && globalContext.activedApplication.init((runtime as VueRuntimeContext), globalContext.activeContext)\n    }\n\n    this.app.status = MOUNT\n\n  }\n\n  /**\n   * @methods { life cycle-unmount }\n   * @des\n   */\n  async unmount(apps: MatchAppType[]) {\n    return new Promise<void>((resolve) => {\n      for(let i = 0; i < apps.length; i++) {\n        // 卸载应用标签\n        for(let j = 0; j < apps[i].app.dynamicElements.length; j++) {\n          removeChild(apps[i].app.dynamicElements[j])\n        }\n\n        apps[i].app.dynamicElements = []\n        // 将状态设置位UNMOUNT\n        apps[i].app.status = UNMOUNT;\n      }\n\n      this.sandbox.inactive()\n\n      resolve()\n    })\n  }\n\n  /**\n   * @methods The application is successfully mounted, and the sub-application is notified\n   */\n  public mounted() {\n\n  }\n\n  /**\n   * @methods Get application js\n   */\n  async getModuleJs(baseDomain: string, assetsData: any): Promise<Project> {\n    const assets = Object.keys(assetsData);\n    for(let i = 0; i < assets.length; i++) {\n      const key = assets[i];\n\n      if(key === 'context' || key === 'version')  {\n        continue\n      }\n\n\n      if(typeof(assetsData[key]) === 'string') {\n        let entry = assetsData[key] || assetsData.app\n        await this.getEntryJs(baseDomain + '/' + entry)\n        this.app.dynamicElements ? (this.app.dynamicElements as Array<string>).push(baseDomain + '/' + assetsData.app)\n        : this.app.dynamicElements = [baseDomain + '/' + assetsData.app]\n        continue\n      }\n\n      /**\n       * @remark for mutile entry\n      */\n      for(let j = 0; j < assetsData[key].length; j++) {\n        const assetsResource = assetsData[key][j]\n        if(assetsResource.indexOf('css/') > -1) {\n          tagLoadCss(baseDomain + '/' + assetsResource)\n        }else {\n          await this.getEntryJs(baseDomain + '/' + assetsResource)\n        }\n\n        this.app.dynamicElements ? (this.app.dynamicElements as Array<string>).push(baseDomain + '/' + assetsResource)\n              : this.app.dynamicElements = [baseDomain + '/' + assetsResource]\n\n        console.log('apps', this.app)\n      }\n    }\n\n    return globalContext.activedApplication\n  }\n\n\n   /**\n   * @methods jsonp loads js files\n   * @param { url - url }\n   */\n  public getEntryJs(url: string): Promise<any> {\n    return new Promise((resolve, reject) => {\n      tagLoadJs(url).then(() => {\n        // 加载完成的内容会挂载到这个globalContext上\n        resolve(globalContext.activeAppInfo)\n      }).catch(e => {\n        reject(e)\n      })\n    })\n  }\n\n  /**\n   * @methods { runtimeInFino }\n   * @desc { 确定当前是否在基座运行 }\n   */\n  public isInFinoRuntime() {\n    return !!getStore('root');\n  }\n\n  public start() {\n    setStore('root', 'root')\n  }\n}\n\nexport default Invoke\n","\nexport const routingEventsListeningTo = [\n  'popstate', 'hashChange'\n]\n\nconst captureEventListeners: any = {\n  'popstate': [],\n  'hashChange': [],\n}\n\nlet historyState: any\n\nexport function callCaptureedEventListeners() {\n  if(historyState) {\n    Object.keys(captureEventListeners).forEach(eventName => {\n      const capturedListeners = (captureEventListeners as any)[eventName];\n      if(capturedListeners.length) {\n        capturedListeners.forEach((listener: any) => {\n          listener.call(null, createPopStateEvent(historyState));\n        })\n      }\n\n    })\n  }\n}\n\nexport function createPopStateEvent(state: any) {\n  // We need a popstate event even though the browser doesn't do one by default when you call replaceState, so that\n  // all the applications can reroute.\n  try {\n    return new PopStateEvent('popstate', { state });\n  } catch (err) {\n    // IE 11 compatibility\n    // https://docs.microsoft.com/en-us/openspecs/ie_standards/ms-html5e/bd560f47-b349-4d2c-baa8-f1560fb489dd\n    const evt: any = document.createEvent('PopStateEvent');\n    evt.initPopStateEvent('popstate', false, false, state);\n    return evt;\n  }\n}\n\nexport function isInCapturedEventListeners(eventName: string, fn: any) {\n  return find(captureEventListeners[eventName], fn);\n}\n\nexport function addCapturedEventListeners(eventName: string, fn: any) {\n  captureEventListeners[eventName].push(fn);\n}\n\nexport function removeCapturedEventListeners(eventName: string, listenerFn: any) {\n  captureEventListeners[eventName] = captureEventListeners[eventName].filter(\n    (fn: any) => fn !== listenerFn,\n  );\n}\n\nexport function find(list: Array<any>, element: any) {\n  if (!Array.isArray(list)) {\n    return false;\n  }\n\n  return list.filter(item => item === element).length > 0;\n}\n\n","import { routingEventsListeningTo, isInCapturedEventListeners, addCapturedEventListeners, removeCapturedEventListeners } from \"./capturedListeners\";\nimport Invoke from \"../invoke\";\nimport { Apps } from \"../applycation/register\";\nimport { globalContext } from \"../global\";\n\n// 缓存原生事件， 后面需要重写\nconst originalAddEventListener = window.addEventListener;\nconst originalRemoveEventLister = window.removeEventListener;\nconst originalPushState = window.history.pushState;\nconst originalReplaceState = window.history.replaceState;\n\nclass Router {\n  public invoke: Invoke\n  constructor(invoke: Invoke) {\n    this.invoke = invoke\n\n    this.hijackHistory();\n    this.hijackEventListener();\n  }\n\n  reroute() {\n    this.invoke.app && this.invoke.performAppChnage(Apps)\n  }\n\n  push(url: string) {\n    // if(globalContext.activeContext.instance) {\n\n    // }\n    // globalContext.activeContext.instance.$router.push(url)\n    window.history.pushState(null, '', url)\n  }\n\n  hijackHistory() {\n    const me = this\n    window.history.pushState = function (state: any, title: string, url: string | null | undefined, ...rest) {\n      let result = originalPushState.apply(this, [state, title, url]);\n      me.reroute()\n      return result\n    }\n\n    window.history.replaceState = function (state: any, title: string, url: string | null | undefined, ...rest) {\n      let result = originalReplaceState.apply(this, [state, title, url])\n      me.reroute();\n      return result;\n    }\n\n    window.onpopstate = (event: PopStateEvent) => {\n\n      me.reroute();\n    }\n\n    window.addEventListener('popstate', () => {\n      me.reroute();\n    }, false);\n  }\n  // EventListenerOrEventListenerObject\n  hijackEventListener() {\n    window.addEventListener = (eventName: string, fn: EventListenerOrEventListenerObject, purpol?: boolean | AddEventListenerOptions) => {\n      if (\n        typeof fn === 'function' &&\n        routingEventsListeningTo.indexOf(eventName) > -1 &&\n        !isInCapturedEventListeners(eventName, fn)\n      ) {\n        addCapturedEventListeners(eventName, fn);\n        return;\n      }\n\n      return originalAddEventListener.apply(window, [eventName, fn, purpol]);\n\n    }\n\n    window.removeEventListener = (eventName: string, fn: EventListenerOrEventListenerObject, purpol?: boolean | AddEventListenerOptions) => {\n      if (typeof fn === 'function' && routingEventsListeningTo.indexOf(eventName) >= 0) {\n        removeCapturedEventListeners(eventName, fn);\n        return;\n      }\n\n      return originalRemoveEventLister.apply(window, [eventName, fn, purpol]);\n    };\n  }\n\n  handlePopState(event: PopStateEvent): void {\n\n  }\n}\n\nexport default Router\n","\nimport { registerApps } from './applycation/register';\nimport Database from '@finoer/finoer-store';\nimport Invoke from './invoke/index';\nimport Router from './router';\nimport { ExtendsDatabaseType, GlobalType } from './types/context';\n\nconst global: GlobalType = window\nconst invoke = new Invoke()\nconst router = new Router(invoke)\nconst $data: ExtendsDatabaseType = global.$data = global.$data ? global.$data : new Database()\n\n// export default finoer\nconsole.log('代码更新了最终版444', $data)\nexport { registerApps, invoke, router, $data}\n\n\n\n\n"],"names":[],"mappings":"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"}